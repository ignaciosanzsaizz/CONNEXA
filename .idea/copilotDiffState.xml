<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/ANUNCIOS_README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/ANUNCIOS_README.md" />
              <option name="originalContent" value="# Documentación del Flujo de Creación de Anuncios&#10;&#10;## Descripción General&#10;&#10;Se ha implementado un flujo completo para crear anuncios en la aplicación Java Swing, siguiendo el patrón MVC y utilizando la infraestructura de comunicación cliente-servidor existente.&#10;&#10;## Componentes Implementados&#10;&#10;### 1. Modelo de Dominio&#10;- **Archivo**: `src/main/java/icai/dtc/isw/domain/Anuncio.java`&#10;- **Descripción**: Clase que representa un anuncio con todos sus atributos.&#10;- **Campos**:&#10;  - `id` (String): Identificador único (UUID)&#10;  - `descripcion` (String): Descripción del anuncio&#10;  - `precio` (Double): Precio del servicio/producto&#10;  - `categoria` (String): Categoría del anuncio&#10;  - `especificacion` (String): Especificaciones adicionales&#10;  - `ubicacion` (String): Ubicación del servicio/producto&#10;  - `nifEmpresa` (String): NIF de la empresa que publica&#10;  - `creadoEn` (Timestamp): Fecha de creación&#10;  - `actualizadoEn` (Timestamp): Fecha de última actualización&#10;&#10;### 2. Capa de Acceso a Datos (DAO)&#10;- **Archivo**: `src/main/java/icai/dtc/isw/dao/AnuncioDAO.java`&#10;- **Métodos principales**:&#10;  - `insert(Anuncio)`: Inserta un nuevo anuncio&#10;  - `findById(String)`: Busca un anuncio por ID&#10;  - `findByNifEmpresa(String)`: Lista anuncios de una empresa&#10;  - `findAll()`: Lista todos los anuncios&#10;&#10;### 3. Controlador&#10;- **Archivo**: `src/main/java/icai/dtc/isw/controler/AnuncioControler.java`&#10;- **Métodos principales**:&#10;  - `createAnuncio(...)`: Crea un anuncio con validaciones&#10;  - `getAnuncio(String)`: Obtiene un anuncio por ID&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;  - `getAllAnuncios()`: Lista todos los anuncios&#10;&#10;### 4. API del Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/AnuncioApi.java`&#10;- **Descripción**: Interfaz para comunicarse con el servidor mediante sockets.&#10;- **Métodos**:&#10;  - `createAnuncio(...)`: Envía petición para crear un anuncio&#10;  - `getAnuncio(String)`: Obtiene un anuncio del servidor&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;&#10;### 5. Interfaz de Usuario&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/CrearAnuncioPanel.java`&#10;- **Descripción**: Diálogo modal para crear un nuevo anuncio.&#10;- **Campos del formulario**:&#10;  - Descripción (área de texto)&#10;  - Precio (campo numérico)&#10;  - Categoría (ComboBox con opciones predefinidas)&#10;  - Especificación (campo de texto)&#10;  - Ubicación (campo de texto)&#10;  - NIF Empresa (campo de solo lectura, auto-rellenado)&#10;&#10;### 6. Integración en EmpresaPanel&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/EmpresaPanel.java`&#10;- **Cambios**: El botón &quot;Poner anuncio&quot; ahora abre el diálogo `CrearAnuncioPanel`.&#10;&#10;### 7. Servidor&#10;- **Archivo**: `src/main/java/icai/dtc/isw/server/SocketServer.java`&#10;- **Endpoints añadidos**:&#10;  - `/anuncio/create`: Crea un nuevo anuncio&#10;  - `/anuncio/get`: Obtiene un anuncio por ID&#10;  - `/anuncio/list`: Lista anuncios de una empresa&#10;&#10;### 8. Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/client/Client.java`&#10;- **Cambios**: Añadidos casos para manejar las respuestas del servidor:&#10;  - `/anuncioCreateResponse`&#10;  - `/anuncioGetResponse`&#10;  - `/anuncioListResponse`&#10;&#10;## Instalación y Configuración&#10;&#10;### 1. Base de Datos&#10;&#10;Ejecuta el script SQL en tu base de datos PostgreSQL de AWS:&#10;&#10;```bash&#10;psql -h ec2-13-60-40-17.eu-north-1.compute.amazonaws.com -U postgres -d postgres -f src/main/resources/create_anuncio_table.sql&#10;```&#10;&#10;O conéctate manualmente y ejecuta el contenido del archivo `create_anuncio_table.sql`.&#10;&#10;### 2. Compilación&#10;&#10;Compila el proyecto usando Maven:&#10;&#10;```bash&#10;mvn clean compile&#10;```&#10;&#10;### 3. Ejecución&#10;&#10;1. **Iniciar el servidor**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.server.SocketServer&#10;   ```&#10;&#10;2. **Iniciar el cliente**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.ui.AppMovilMock&#10;   ```&#10;&#10;## Flujo de Uso&#10;&#10;1. El usuario inicia sesión en la aplicación.&#10;2. Navega a &quot;Mi Empresa&quot;.&#10;3. Si ya tiene el perfil de empresa completado, verá el botón &quot;Poner anuncio&quot;.&#10;4. Al hacer clic en &quot;Poner anuncio&quot;, se abre un diálogo modal.&#10;5. Rellena todos los campos obligatorios:&#10;   - **Descripción**: Texto largo describiendo el anuncio&#10;   - **Precio**: Valor numérico (ej: 99.99)&#10;   - **Categoría**: Selección de una lista desplegable&#10;   - **Especificación**: Detalles adicionales&#10;   - **Ubicación**: Dónde se ofrece el servicio/producto&#10;   - **NIF Empresa**: Auto-rellenado (solo lectura)&#10;6. Hace clic en &quot;Crear anuncio&quot;.&#10;7. El sistema valida los campos:&#10;   - Ningún campo puede estar vacío&#10;   - El precio debe ser un número válido mayor que cero&#10;8. Si todo es correcto, se envía al servidor.&#10;9. El servidor crea el anuncio en la base de datos.&#10;10. Se muestra un mensaje de éxito y se cierra el diálogo.&#10;&#10;## Validaciones Implementadas&#10;&#10;### En el Cliente (CrearAnuncioPanel)&#10;- Campos obligatorios no pueden estar vacíos&#10;- El precio debe ser un número válido&#10;- El precio debe ser mayor que cero&#10;&#10;### En el Controlador (AnuncioControler)&#10;- Validación de campos nulos o vacíos&#10;- Validación de precio positivo&#10;- Generación automática de UUID para el ID&#10;&#10;### En la Base de Datos&#10;- Restricción CHECK para precio &gt; 0&#10;- Clave foránea hacia la tabla empresa&#10;- Timestamps automáticos para creado_en y actualizado_en&#10;- Trigger para actualizar actualizado_en automáticamente&#10;&#10;## Categorías Disponibles&#10;&#10;1. Hogar y reparaciones&#10;2. Salud, belleza y cuidados&#10;3. Educación y cultura&#10;4. Eventos y ocio&#10;5. Negocio y administración&#10;6. Logística y movilidad&#10;7. Tecnología y digital&#10;&#10;## Estructura de la Tabla en PostgreSQL&#10;&#10;```sql&#10;CREATE TABLE anuncio (&#10;    id VARCHAR(255) PRIMARY KEY,&#10;    descripcion TEXT NOT NULL,&#10;    precio DECIMAL(10, 2) NOT NULL CHECK (precio &gt; 0),&#10;    categoria VARCHAR(100) NOT NULL,&#10;    especificacion TEXT NOT NULL,&#10;    ubicacion VARCHAR(255) NOT NULL,&#10;    nif_empresa VARCHAR(50) NOT NULL,&#10;    creado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    actualizado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    FOREIGN KEY (nif_empresa) REFERENCES empresa(nif)&#10;);&#10;```&#10;&#10;## Gestión de Errores&#10;&#10;- Si falta algún campo: mensaje de advertencia&#10;- Si el precio no es numérico: mensaje de error&#10;- Si hay error en el guardado: mensaje de error con detalles&#10;- Si todo es correcto: mensaje de éxito&#10;&#10;## Notas Técnicas&#10;&#10;- **Patrón de diseño**: MVC (Model-View-Controller)&#10;- **Comunicación**: Cliente-Servidor mediante sockets&#10;- **Serialización**: Java Serialization para objetos de dominio&#10;- **Generación de ID**: UUID aleatorio en el controlador&#10;- **Conexión a BD**: Lee configuración de `properties.xml`&#10;- **Thread-safe**: Cada petición se maneja en un hilo separado en el servidor&#10;&#10;## Extensiones Futuras&#10;&#10;Posibles mejoras que se pueden implementar:&#10;&#10;1. **Listado de anuncios**: Panel para ver todos los anuncios de una empresa&#10;2. **Edición de anuncios**: Permitir modificar anuncios existentes&#10;3. **Eliminación de anuncios**: Permitir borrar anuncios&#10;4. **Búsqueda y filtrado**: Buscar anuncios por categoría, precio, ubicación&#10;5. **Imágenes**: Añadir soporte para imágenes en los anuncios&#10;6. **Estadísticas**: Panel con métricas sobre los anuncios publicados&#10;7. **Notificaciones**: Alertar cuando se crea un nuevo anuncio en una categoría&#10;&#10;## Solución de Problemas&#10;&#10;### Error de conexión a la base de datos&#10;- Verifica que la IP en `properties.xml` sea correcta&#10;- Confirma que el servidor PostgreSQL esté activo&#10;- Comprueba las credenciales de acceso&#10;&#10;### El botón &quot;Poner anuncio&quot; no aparece&#10;- Asegúrate de que el usuario tenga el perfil de empresa completado&#10;- Verifica que el NIF de la empresa esté guardado en la BD&#10;&#10;### Error al crear anuncio&#10;- Revisa los logs del servidor para más detalles&#10;- Verifica que la tabla `anuncio` exista en la base de datos&#10;- Confirma que exista la clave foránea hacia la tabla `empresa`&#10;&#10;## Contacto y Soporte&#10;&#10;Para más información o soporte, contacta con el equipo de desarrollo.&#10;&#10;" />
              <option name="updatedContent" value="# Documentación del Flujo de Creación de Anuncios&#10;&#10;## Descripción General&#10;&#10;Se ha implementado un flujo completo para crear anuncios en la aplicación Java Swing, siguiendo el patrón MVC y utilizando la infraestructura de comunicación cliente-servidor existente.&#10;&#10;## Componentes Implementados&#10;&#10;### 1. Modelo de Dominio&#10;- **Archivo**: `src/main/java/icai/dtc/isw/domain/Anuncio.java`&#10;- **Descripción**: Clase que representa un anuncio con todos sus atributos.&#10;- **Campos**:&#10;  - `id` (String): Identificador único (UUID)&#10;  - `descripcion` (String): Descripción del anuncio&#10;  - `precio` (Double): Precio del servicio/producto&#10;  - `categoria` (String): Categoría del anuncio&#10;  - `especificacion` (String): Especificaciones adicionales&#10;  - `ubicacion` (String): Ubicación del servicio/producto&#10;  - `nifEmpresa` (String): NIF de la empresa que publica&#10;  - `creadoEn` (Timestamp): Fecha de creación&#10;  - `actualizadoEn` (Timestamp): Fecha de última actualización&#10;&#10;### 2. Capa de Acceso a Datos (DAO)&#10;- **Archivo**: `src/main/java/icai/dtc/isw/dao/AnuncioDAO.java`&#10;- **Métodos principales**:&#10;  - `insert(Anuncio)`: Inserta un nuevo anuncio&#10;  - `findById(String)`: Busca un anuncio por ID&#10;  - `findByNifEmpresa(String)`: Lista anuncios de una empresa&#10;  - `findAll()`: Lista todos los anuncios&#10;&#10;### 3. Controlador&#10;- **Archivo**: `src/main/java/icai/dtc/isw/controler/AnuncioControler.java`&#10;- **Métodos principales**:&#10;  - `createAnuncio(...)`: Crea un anuncio con validaciones&#10;  - `getAnuncio(String)`: Obtiene un anuncio por ID&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;  - `getAllAnuncios()`: Lista todos los anuncios&#10;&#10;### 4. API del Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/AnuncioApi.java`&#10;- **Descripción**: Interfaz para comunicarse con el servidor mediante sockets.&#10;- **Métodos**:&#10;  - `createAnuncio(...)`: Envía petición para crear un anuncio&#10;  - `getAnuncio(String)`: Obtiene un anuncio del servidor&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;&#10;### 5. Interfaz de Usuario&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/CrearAnuncioPanel.java`&#10;- **Descripción**: Diálogo modal para crear un nuevo anuncio.&#10;- **Campos del formulario**:&#10;  - Descripción (área de texto)&#10;  - Precio (campo numérico)&#10;  - Categoría (ComboBox con opciones predefinidas)&#10;  - Especificación (campo de texto)&#10;  - Ubicación (campo de texto)&#10;  - NIF Empresa (campo de solo lectura, auto-rellenado)&#10;&#10;### 6. Integración en EmpresaPanel&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/EmpresaPanel.java`&#10;- **Cambios**: El botón &quot;Poner anuncio&quot; ahora abre el diálogo `CrearAnuncioPanel`.&#10;&#10;### 7. Servidor&#10;- **Archivo**: `src/main/java/icai/dtc/isw/server/SocketServer.java`&#10;- **Endpoints añadidos**:&#10;  - `/anuncio/create`: Crea un nuevo anuncio&#10;  - `/anuncio/get`: Obtiene un anuncio por ID&#10;  - `/anuncio/list`: Lista anuncios de una empresa&#10;&#10;### 8. Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/client/Client.java`&#10;- **Cambios**: Añadidos casos para manejar las respuestas del servidor:&#10;  - `/anuncioCreateResponse`&#10;  - `/anuncioGetResponse`&#10;  - `/anuncioListResponse`&#10;&#10;## Instalación y Configuración&#10;&#10;### 1. Base de Datos&#10;&#10;Ejecuta el script SQL en tu base de datos PostgreSQL de AWS:&#10;&#10;```bash&#10;psql -h ec2-13-60-40-17.eu-north-1.compute.amazonaws.com -U postgres -d postgres -f src/main/resources/create_anuncio_table.sql&#10;```&#10;&#10;O conéctate manualmente y ejecuta el contenido del archivo `create_anuncio_table.sql`.&#10;&#10;### 2. Compilación&#10;&#10;Compila el proyecto usando Maven:&#10;&#10;```bash&#10;mvn clean compile&#10;```&#10;&#10;### 3. Ejecución&#10;&#10;1. **Iniciar el servidor**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.server.SocketServer&#10;   ```&#10;&#10;2. **Iniciar el cliente**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.ui.AppMovilMock&#10;   ```&#10;&#10;## Flujo de Uso&#10;&#10;1. El usuario inicia sesión en la aplicación.&#10;2. Navega a &quot;Mi Empresa&quot;.&#10;3. Si ya tiene el perfil de empresa completado, verá el botón &quot;Poner anuncio&quot;.&#10;4. Al hacer clic en &quot;Poner anuncio&quot;, se abre un diálogo modal.&#10;5. Rellena todos los campos obligatorios:&#10;   - **Descripción**: Texto largo describiendo el anuncio&#10;   - **Precio**: Valor numérico (ej: 99.99)&#10;   - **Categoría**: Selección de una lista desplegable&#10;   - **Especificación**: Detalles adicionales&#10;   - **Ubicación**: Dónde se ofrece el servicio/producto&#10;   - **NIF Empresa**: Auto-rellenado (solo lectura)&#10;6. Hace clic en &quot;Crear anuncio&quot;.&#10;7. El sistema valida los campos:&#10;   - Ningún campo puede estar vacío&#10;   - El precio debe ser un número válido mayor que cero&#10;8. Si todo es correcto, se envía al servidor.&#10;9. El servidor crea el anuncio en la base de datos.&#10;10. Se muestra un mensaje de éxito y se cierra el diálogo.&#10;&#10;## Validaciones Implementadas&#10;&#10;### En el Cliente (CrearAnuncioPanel)&#10;- Campos obligatorios no pueden estar vacíos&#10;- El precio debe ser un número válido&#10;- El precio debe ser mayor que cero&#10;&#10;### En el Controlador (AnuncioControler)&#10;- Validación de campos nulos o vacíos&#10;- Validación de precio positivo&#10;- Generación automática de UUID para el ID&#10;&#10;### En la Base de Datos&#10;- Restricción CHECK para precio &gt; 0&#10;- Clave foránea hacia la tabla empresa&#10;- Timestamps automáticos para creado_en y actualizado_en&#10;- Trigger para actualizar actualizado_en automáticamente&#10;&#10;## Categorías Disponibles&#10;&#10;1. Hogar y reparaciones&#10;2. Salud, belleza y cuidados&#10;3. Educación y cultura&#10;4. Eventos y ocio&#10;5. Negocio y administración&#10;6. Logística y movilidad&#10;7. Tecnología y digital&#10;&#10;## Estructura de la Tabla en PostgreSQL&#10;&#10;**Nombre de la tabla:** `anuncios` (plural)&#10;&#10;```sql&#10;CREATE TABLE anuncios (&#10;    id VARCHAR(255) PRIMARY KEY,&#10;    descripcion TEXT NOT NULL,&#10;    precio DECIMAL(10, 2) NOT NULL CHECK (precio &gt; 0),&#10;    categoria VARCHAR(100) NOT NULL,&#10;    especificacion TEXT NOT NULL,&#10;    ubicacion VARCHAR(255) NOT NULL,&#10;    nif_empresa VARCHAR(50) NOT NULL,&#10;    creado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    actualizado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    FOREIGN KEY (nif_empresa) REFERENCES empresa(nif)&#10;);&#10;```&#10;&#10;## Gestión de Errores&#10;&#10;- Si falta algún campo: mensaje de advertencia&#10;- Si el precio no es numérico: mensaje de error&#10;- Si hay error en el guardado: mensaje de error con detalles&#10;- Si todo es correcto: mensaje de éxito&#10;&#10;## Notas Técnicas&#10;&#10;- **Patrón de diseño**: MVC (Model-View-Controller)&#10;- **Comunicación**: Cliente-Servidor mediante sockets&#10;- **Serialización**: Java Serialization para objetos de dominio&#10;- **Generación de ID**: UUID aleatorio en el controlador&#10;- **Conexión a BD**: Lee configuración de `properties.xml`&#10;- **Thread-safe**: Cada petición se maneja en un hilo separado en el servidor&#10;&#10;## Extensiones Futuras&#10;&#10;Posibles mejoras que se pueden implementar:&#10;&#10;1. **Listado de anuncios**: Panel para ver todos los anuncios de una empresa&#10;2. **Edición de anuncios**: Permitir modificar anuncios existentes&#10;3. **Eliminación de anuncios**: Permitir borrar anuncios&#10;4. **Búsqueda y filtrado**: Buscar anuncios por categoría, precio, ubicación&#10;5. **Imágenes**: Añadir soporte para imágenes en los anuncios&#10;6. **Estadísticas**: Panel con métricas sobre los anuncios publicados&#10;7. **Notificaciones**: Alertar cuando se crea un nuevo anuncio en una categoría&#10;&#10;## Solución de Problemas&#10;&#10;### Error de conexión a la base de datos&#10;- Verifica que la IP en `properties.xml` sea correcta&#10;- Confirma que el servidor PostgreSQL esté activo&#10;- Comprueba las credenciales de acceso&#10;&#10;### El botón &quot;Poner anuncio&quot; no aparece&#10;- Asegúrate de que el usuario tenga el perfil de empresa completado&#10;- Verifica que el NIF de la empresa esté guardado en la BD&#10;&#10;### Error al crear anuncio&#10;- Revisa los logs del servidor para más detalles&#10;- Verifica que la tabla `anuncio` exista en la base de datos&#10;- Confirma que exista la clave foránea hacia la tabla `empresa`&#10;&#10;## Contacto y Soporte&#10;&#10;Para más información o soporte, contacta con el equipo de desarrollo.&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/icai/dtc/isw/dao/AnuncioDAO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/icai/dtc/isw/dao/AnuncioDAO.java" />
              <option name="originalContent" value="package icai.dtc.isw.dao;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class AnuncioDAO {&#10;&#10;    /**&#10;     * Inserta un nuevo anuncio en la base de datos.&#10;     * Los campos creado_en y actualizado_en se establecen a NOW().&#10;     */&#10;    public boolean insert(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            INSERT INTO anuncios (id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en)&#10;            VALUES (?, ?, ?, ?, ?, ?, ?, NOW(), NOW())&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getId());&#10;            pst.setString(2, anuncio.getDescripcion());&#10;            pst.setDouble(3, anuncio.getPrecio());&#10;            pst.setString(4, anuncio.getCategoria());&#10;            pst.setString(5, anuncio.getEspecificacion());&#10;            pst.setString(6, anuncio.getUbicacion());&#10;            pst.setString(7, anuncio.getNifEmpresa());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Obtiene un anuncio por su ID.&#10;     */&#10;    public Anuncio findById(String id) {&#10;        if (id == null || id.isBlank()) return null;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                if (rs.next()) {&#10;                    return mapResultSetToAnuncio(rs);&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios de una empresa (por NIF).&#10;     */&#10;    public List&lt;Anuncio&gt; findByNifEmpresa(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        if (nifEmpresa == null || nifEmpresa.isBlank()) return anuncios;&#10;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE nif_empresa = ? ORDER BY creado_en DESC&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, nifEmpresa);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                while (rs.next()) {&#10;                    anuncios.add(mapResultSetToAnuncio(rs));&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios.&#10;     */&#10;    public List&lt;Anuncio&gt; findAll() {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios ORDER BY creado_en DESC&quot;;&#10;&#10;        try (Statement st = con.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) {&#10;                anuncios.add(mapResultSetToAnuncio(rs));&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Actualiza un anuncio existente.&#10;     * El campo actualizado_en se establece a NOW().&#10;     */&#10;    public boolean update(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            UPDATE anuncios &#10;            SET descripcion = ?, precio = ?, categoria = ?, especificacion = ?, &#10;                ubicacion = ?, actualizado_en = NOW()&#10;            WHERE id = ?&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getDescripcion());&#10;            pst.setDouble(2, anuncio.getPrecio());&#10;            pst.setString(3, anuncio.getCategoria());&#10;            pst.setString(4, anuncio.getEspecificacion());&#10;            pst.setString(5, anuncio.getUbicacion());&#10;            pst.setString(6, anuncio.getId());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Elimina un anuncio por su ID.&#10;     */&#10;    public boolean delete(String id) {&#10;        if (id == null || id.isBlank()) return false;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;DELETE FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Mapea un ResultSet a un objeto Anuncio.&#10;     */&#10;    private Anuncio mapResultSetToAnuncio(ResultSet rs) throws SQLException {&#10;        Anuncio a = new Anuncio();&#10;        a.setId(rs.getString(&quot;id&quot;));&#10;        a.setDescripcion(rs.getString(&quot;descripcion&quot;));&#10;        a.setPrecio(rs.getDouble(&quot;precio&quot;));&#10;        a.setCategoria(rs.getString(&quot;categoria&quot;));&#10;        a.setEspecificacion(rs.getString(&quot;especificacion&quot;));&#10;        a.setUbicacion(rs.getString(&quot;ubicacion&quot;));&#10;        a.setNifEmpresa(rs.getString(&quot;nif_empresa&quot;));&#10;        a.setCreadoEn(rs.getTimestamp(&quot;creado_en&quot;));&#10;        a.setActualizadoEn(rs.getTimestamp(&quot;actualizado_en&quot;));&#10;        return a;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package icai.dtc.isw.dao;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class AnuncioDAO {&#10;&#10;    /**&#10;     * Inserta un nuevo anuncio en la base de datos.&#10;     * Los campos creado_en y actualizado_en se establecen a NOW().&#10;     */&#10;    public boolean insert(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            INSERT INTO anuncios (id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en)&#10;            VALUES (?, ?, ?, ?, ?, ?, ?, NOW(), NOW())&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getId());&#10;            pst.setString(2, anuncio.getDescripcion());&#10;            pst.setDouble(3, anuncio.getPrecio());&#10;            pst.setString(4, anuncio.getCategoria());&#10;            pst.setString(5, anuncio.getEspecificacion());&#10;            pst.setString(6, anuncio.getUbicacion());&#10;            pst.setString(7, anuncio.getNifEmpresa());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Obtiene un anuncio por su ID.&#10;     */&#10;    public Anuncio findById(String id) {&#10;        if (id == null || id.isBlank()) return null;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                if (rs.next()) {&#10;                    return mapResultSetToAnuncio(rs);&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios de una empresa (por NIF).&#10;     */&#10;    public List&lt;Anuncio&gt; findByNifEmpresa(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        if (nifEmpresa == null || nifEmpresa.isBlank()) return anuncios;&#10;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE nif_empresa = ? ORDER BY creado_en DESC&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, nifEmpresa);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                while (rs.next()) {&#10;                    anuncios.add(mapResultSetToAnuncio(rs));&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios.&#10;     */&#10;    public List&lt;Anuncio&gt; findAll() {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios ORDER BY creado_en DESC&quot;;&#10;&#10;        try (Statement st = con.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) {&#10;                anuncios.add(mapResultSetToAnuncio(rs));&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Actualiza un anuncio existente.&#10;     * El campo actualizado_en se establece a NOW().&#10;     */&#10;    public boolean update(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            UPDATE anuncios &#10;            SET descripcion = ?, precio = ?, categoria = ?, especificacion = ?, &#10;                ubicacion = ?, actualizado_en = NOW()&#10;            WHERE id = ?&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getDescripcion());&#10;            pst.setDouble(2, anuncio.getPrecio());&#10;            pst.setString(3, anuncio.getCategoria());&#10;            pst.setString(4, anuncio.getEspecificacion());&#10;            pst.setString(5, anuncio.getUbicacion());&#10;            pst.setString(6, anuncio.getId());&#10;&#10;            int rows = pst.executeUpdate();&#10;            System.out.println(&quot;AnuncioDAO.update: Filas actualizadas = &quot; + rows + &quot; para ID = &quot; + anuncio.getId());&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;AnuncioDAO.update: Error SQL al actualizar anuncio ID = &quot; + anuncio.getId());&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Elimina un anuncio por su ID.&#10;     */&#10;    public boolean delete(String id) {&#10;        if (id == null || id.isBlank()) {&#10;            System.out.println(&quot;AnuncioDAO.delete: ID es null o vacío&quot;);&#10;            return false;&#10;        }&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;DELETE FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            int rows = pst.executeUpdate();&#10;            System.out.println(&quot;AnuncioDAO.delete: Filas eliminadas = &quot; + rows + &quot; para ID = &quot; + id);&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;AnuncioDAO.delete: Error SQL al eliminar anuncio ID = &quot; + id);&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Mapea un ResultSet a un objeto Anuncio.&#10;     */&#10;    private Anuncio mapResultSetToAnuncio(ResultSet rs) throws SQLException {&#10;        Anuncio a = new Anuncio();&#10;        a.setId(rs.getString(&quot;id&quot;));&#10;        a.setDescripcion(rs.getString(&quot;descripcion&quot;));&#10;        a.setPrecio(rs.getDouble(&quot;precio&quot;));&#10;        a.setCategoria(rs.getString(&quot;categoria&quot;));&#10;        a.setEspecificacion(rs.getString(&quot;especificacion&quot;));&#10;        a.setUbicacion(rs.getString(&quot;ubicacion&quot;));&#10;        a.setNifEmpresa(rs.getString(&quot;nif_empresa&quot;));&#10;        a.setCreadoEn(rs.getTimestamp(&quot;creado_en&quot;));&#10;        a.setActualizadoEn(rs.getTimestamp(&quot;actualizado_en&quot;));&#10;        return a;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/icai/dtc/isw/ui/EditarAnuncioPanel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/icai/dtc/isw/ui/EditarAnuncioPanel.java" />
              <option name="originalContent" value="package icai.dtc.isw.ui;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import javax.swing.*;&#10;import javax.swing.border.EmptyBorder;&#10;import java.awt.*;&#10;&#10;public class EditarAnuncioPanel extends JDialog {&#10;&#10;    private final AnuncioApi api = new AnuncioApi();&#10;    private final Anuncio anuncio;&#10;&#10;    // Categorías permitidas&#10;    private static final String[] CATEGORIAS = {&#10;        &quot;Hogar y reparaciones&quot;,&#10;        &quot;Salud, belleza y cuidados&quot;,&#10;        &quot;Educación y cultura&quot;,&#10;        &quot;Eventos y ocio&quot;,&#10;        &quot;Negocio y administración&quot;,&#10;        &quot;Logística y movilidad&quot;,&#10;        &quot;Tecnología y digital&quot;&#10;    };&#10;&#10;    // Componentes del formulario&#10;    private JTextArea txtDescripcion;&#10;    private JTextField txtPrecio;&#10;    private JComboBox&lt;String&gt; cboCategoria;&#10;    private JTextField txtEspecificacion;&#10;    private JTextField txtUbicacion;&#10;&#10;    public EditarAnuncioPanel(Frame parent, Anuncio anuncio) {&#10;        super(parent, &quot;Editar Anuncio&quot;, true);&#10;        this.anuncio = anuncio;&#10;&#10;        initComponents();&#10;        cargarDatos();&#10;        setLocationRelativeTo(parent);&#10;    }&#10;&#10;    private void initComponents() {&#10;        setLayout(new BorderLayout(10, 10));&#10;        setBackground(new Color(245, 247, 250));&#10;&#10;        // Panel principal con el formulario&#10;        JPanel mainPanel = new JPanel();&#10;        mainPanel.setLayout(new BorderLayout());&#10;        mainPanel.setBackground(Color.WHITE);&#10;        mainPanel.setBorder(new EmptyBorder(20, 20, 20, 20));&#10;&#10;        // Título&#10;        JLabel titleLabel = new JLabel(&quot;Editar anuncio&quot;, SwingConstants.CENTER);&#10;        titleLabel.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 20));&#10;        titleLabel.setForeground(new Color(20, 40, 80));&#10;        titleLabel.setBorder(new EmptyBorder(0, 0, 15, 0));&#10;        mainPanel.add(titleLabel, BorderLayout.NORTH);&#10;&#10;        // Formulario&#10;        JPanel formPanel = new JPanel(new GridBagLayout());&#10;        formPanel.setBackground(Color.WHITE);&#10;        GridBagConstraints gbc = UIUtils.baseGbc();&#10;&#10;        // Descripción (JTextArea)&#10;        gbc.gridy = 0;&#10;        formPanel.add(createLabel(&quot;Descripción:&quot;), gbc);&#10;&#10;        txtDescripcion = new JTextArea(4, 22);&#10;        txtDescripcion.setLineWrap(true);&#10;        txtDescripcion.setWrapStyleWord(true);&#10;        txtDescripcion.setBorder(BorderFactory.createCompoundBorder(&#10;                new UIUtils.RoundedBorder(12, new Color(220, 226, 235)),&#10;                new EmptyBorder(8, 10, 8, 10)&#10;        ));&#10;        txtDescripcion.setBackground(new Color(250, 251, 253));&#10;        JScrollPane scrollDesc = new JScrollPane(txtDescripcion);&#10;        scrollDesc.setBorder(new UIUtils.RoundedBorder(12, new Color(220, 226, 235)));&#10;        gbc.gridy = 1;&#10;        formPanel.add(scrollDesc, gbc);&#10;&#10;        // Precio&#10;        gbc.gridy = 2;&#10;        formPanel.add(createLabel(&quot;Precio (€):&quot;), gbc);&#10;        txtPrecio = UIUtils.styledTextField(22);&#10;        gbc.gridy = 3;&#10;        formPanel.add(txtPrecio, gbc);&#10;&#10;        // Categoría&#10;        gbc.gridy = 4;&#10;        formPanel.add(createLabel(&quot;Categoría:&quot;), gbc);&#10;        cboCategoria = UIUtils.styledCombo(CATEGORIAS);&#10;        gbc.gridy = 5;&#10;        formPanel.add(cboCategoria, gbc);&#10;&#10;        // Especificación&#10;        gbc.gridy = 6;&#10;        formPanel.add(createLabel(&quot;Especificación:&quot;), gbc);&#10;        txtEspecificacion = UIUtils.styledTextField(22);&#10;        gbc.gridy = 7;&#10;        formPanel.add(txtEspecificacion, gbc);&#10;&#10;        // Ubicación&#10;        gbc.gridy = 8;&#10;        formPanel.add(createLabel(&quot;Ubicación:&quot;), gbc);&#10;        txtUbicacion = UIUtils.styledTextField(22);&#10;        gbc.gridy = 9;&#10;        formPanel.add(txtUbicacion, gbc);&#10;&#10;        mainPanel.add(formPanel, BorderLayout.CENTER);&#10;&#10;        // Botones&#10;        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 10, 10));&#10;        buttonPanel.setBackground(Color.WHITE);&#10;&#10;        JButton btnGuardar = UIUtils.primaryButton(&quot;Guardar cambios&quot;);&#10;        btnGuardar.addActionListener(e -&gt; guardarCambios());&#10;&#10;        JButton btnCancelar = UIUtils.secondaryButton(&quot;Cancelar&quot;);&#10;        btnCancelar.addActionListener(e -&gt; dispose());&#10;&#10;        buttonPanel.add(btnGuardar);&#10;        buttonPanel.add(btnCancelar);&#10;&#10;        mainPanel.add(buttonPanel, BorderLayout.SOUTH);&#10;&#10;        add(mainPanel, BorderLayout.CENTER);&#10;&#10;        pack();&#10;        setMinimumSize(new Dimension(500, 580));&#10;    }&#10;&#10;    private void cargarDatos() {&#10;        if (anuncio != null) {&#10;            txtDescripcion.setText(anuncio.getDescripcion());&#10;            txtPrecio.setText(String.valueOf(anuncio.getPrecio()));&#10;            cboCategoria.setSelectedItem(anuncio.getCategoria());&#10;            txtEspecificacion.setText(anuncio.getEspecificacion());&#10;            txtUbicacion.setText(anuncio.getUbicacion());&#10;        }&#10;    }&#10;&#10;    private JLabel createLabel(String text) {&#10;        JLabel label = new JLabel(text);&#10;        label.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 13));&#10;        label.setForeground(new Color(60, 70, 90));&#10;        return label;&#10;    }&#10;&#10;    private void guardarCambios() {&#10;        // Obtener valores&#10;        String descripcion = txtDescripcion.getText().trim();&#10;        String precioStr = txtPrecio.getText().trim();&#10;        String categoria = (String) cboCategoria.getSelectedItem();&#10;        String especificacion = txtEspecificacion.getText().trim();&#10;        String ubicacion = txtUbicacion.getText().trim();&#10;&#10;        // Validar campos obligatorios&#10;        if (descripcion.isEmpty()) {&#10;            mostrarError(&quot;La descripción es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (precioStr.isEmpty()) {&#10;            mostrarError(&quot;El precio es obligatorio.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Validar que el precio sea numérico&#10;        Double precio;&#10;        try {&#10;            precio = Double.parseDouble(precioStr);&#10;            if (precio &lt;= 0) {&#10;                mostrarError(&quot;El precio debe ser mayor que cero.&quot;);&#10;                return;&#10;            }&#10;        } catch (NumberFormatException e) {&#10;            mostrarError(&quot;El precio debe ser un número válido.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (categoria == null || categoria.isEmpty()) {&#10;            mostrarError(&quot;Debes seleccionar una categoría.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (especificacion.isEmpty()) {&#10;            mostrarError(&quot;La especificación es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (ubicacion.isEmpty()) {&#10;            mostrarError(&quot;La ubicación es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Intentar actualizar el anuncio&#10;        try {&#10;            boolean exito = api.updateAnuncio(anuncio.getId(), descripcion, precio,&#10;                                             categoria, especificacion, ubicacion);&#10;&#10;            if (exito) {&#10;                JOptionPane.showMessageDialog(&#10;                    this,&#10;                    &quot;Anuncio actualizado correctamente.&quot;,&#10;                    &quot;Éxito&quot;,&#10;                    JOptionPane.INFORMATION_MESSAGE&#10;                );&#10;&#10;                // Cerrar el diálogo&#10;                dispose();&#10;            } else {&#10;                mostrarError(&quot;No se pudo actualizar el anuncio. Inténtalo de nuevo.&quot;);&#10;            }&#10;        } catch (Exception ex) {&#10;            ex.printStackTrace();&#10;            mostrarError(&quot;Ocurrió un error al actualizar el anuncio: &quot; + ex.getMessage());&#10;        }&#10;    }&#10;&#10;    private void mostrarError(String mensaje) {&#10;        JOptionPane.showMessageDialog(&#10;            this,&#10;            mensaje,&#10;            &quot;Error de validación&quot;,&#10;            JOptionPane.ERROR_MESSAGE&#10;        );&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package icai.dtc.isw.ui;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import javax.swing.*;&#10;import javax.swing.border.EmptyBorder;&#10;import java.awt.*;&#10;&#10;public class EditarAnuncioPanel extends JDialog {&#10;&#10;    private final AnuncioApi api = new AnuncioApi();&#10;    private final Anuncio anuncio;&#10;    private final EmpresaPanel empresaPanel;&#10;&#10;    // Categorías permitidas&#10;    private static final String[] CATEGORIAS = {&#10;        &quot;Hogar y reparaciones&quot;,&#10;        &quot;Salud, belleza y cuidados&quot;,&#10;        &quot;Educación y cultura&quot;,&#10;        &quot;Eventos y ocio&quot;,&#10;        &quot;Negocio y administración&quot;,&#10;        &quot;Logística y movilidad&quot;,&#10;        &quot;Tecnología y digital&quot;&#10;    };&#10;&#10;    // Componentes del formulario&#10;    private JTextArea txtDescripcion;&#10;    private JTextField txtPrecio;&#10;    private JComboBox&lt;String&gt; cboCategoria;&#10;    private JTextField txtEspecificacion;&#10;    private JTextField txtUbicacion;&#10;&#10;    public EditarAnuncioPanel(Frame parent, Anuncio anuncio, EmpresaPanel empresaPanel) {&#10;        super(parent, &quot;Editar Anuncio&quot;, true);&#10;        this.anuncio = anuncio;&#10;        this.empresaPanel = empresaPanel;&#10;&#10;        initComponents();&#10;        cargarDatos();&#10;        setLocationRelativeTo(parent);&#10;    }&#10;&#10;    private void initComponents() {&#10;        setLayout(new BorderLayout(10, 10));&#10;        setBackground(new Color(245, 247, 250));&#10;&#10;        // Panel principal con el formulario&#10;        JPanel mainPanel = new JPanel();&#10;        mainPanel.setLayout(new BorderLayout());&#10;        mainPanel.setBackground(Color.WHITE);&#10;        mainPanel.setBorder(new EmptyBorder(20, 20, 20, 20));&#10;&#10;        // Título&#10;        JLabel titleLabel = new JLabel(&quot;Editar anuncio&quot;, SwingConstants.CENTER);&#10;        titleLabel.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 20));&#10;        titleLabel.setForeground(new Color(20, 40, 80));&#10;        titleLabel.setBorder(new EmptyBorder(0, 0, 15, 0));&#10;        mainPanel.add(titleLabel, BorderLayout.NORTH);&#10;&#10;        // Formulario&#10;        JPanel formPanel = new JPanel(new GridBagLayout());&#10;        formPanel.setBackground(Color.WHITE);&#10;        GridBagConstraints gbc = UIUtils.baseGbc();&#10;&#10;        // Descripción (JTextArea)&#10;        gbc.gridy = 0;&#10;        formPanel.add(createLabel(&quot;Descripción:&quot;), gbc);&#10;&#10;        txtDescripcion = new JTextArea(4, 22);&#10;        txtDescripcion.setLineWrap(true);&#10;        txtDescripcion.setWrapStyleWord(true);&#10;        txtDescripcion.setBorder(BorderFactory.createCompoundBorder(&#10;                new UIUtils.RoundedBorder(12, new Color(220, 226, 235)),&#10;                new EmptyBorder(8, 10, 8, 10)&#10;        ));&#10;        txtDescripcion.setBackground(new Color(250, 251, 253));&#10;        JScrollPane scrollDesc = new JScrollPane(txtDescripcion);&#10;        scrollDesc.setBorder(new UIUtils.RoundedBorder(12, new Color(220, 226, 235)));&#10;        gbc.gridy = 1;&#10;        formPanel.add(scrollDesc, gbc);&#10;&#10;        // Precio&#10;        gbc.gridy = 2;&#10;        formPanel.add(createLabel(&quot;Precio (€):&quot;), gbc);&#10;        txtPrecio = UIUtils.styledTextField(22);&#10;        gbc.gridy = 3;&#10;        formPanel.add(txtPrecio, gbc);&#10;&#10;        // Categoría&#10;        gbc.gridy = 4;&#10;        formPanel.add(createLabel(&quot;Categoría:&quot;), gbc);&#10;        cboCategoria = UIUtils.styledCombo(CATEGORIAS);&#10;        gbc.gridy = 5;&#10;        formPanel.add(cboCategoria, gbc);&#10;&#10;        // Especificación&#10;        gbc.gridy = 6;&#10;        formPanel.add(createLabel(&quot;Especificación:&quot;), gbc);&#10;        txtEspecificacion = UIUtils.styledTextField(22);&#10;        gbc.gridy = 7;&#10;        formPanel.add(txtEspecificacion, gbc);&#10;&#10;        // Ubicación&#10;        gbc.gridy = 8;&#10;        formPanel.add(createLabel(&quot;Ubicación:&quot;), gbc);&#10;        txtUbicacion = UIUtils.styledTextField(22);&#10;        gbc.gridy = 9;&#10;        formPanel.add(txtUbicacion, gbc);&#10;&#10;        mainPanel.add(formPanel, BorderLayout.CENTER);&#10;&#10;        // Botones&#10;        JPanel buttonPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, 10, 10));&#10;        buttonPanel.setBackground(Color.WHITE);&#10;&#10;        JButton btnGuardar = UIUtils.primaryButton(&quot;Guardar cambios&quot;);&#10;        btnGuardar.addActionListener(e -&gt; guardarCambios());&#10;&#10;        JButton btnCancelar = UIUtils.secondaryButton(&quot;Cancelar&quot;);&#10;        btnCancelar.addActionListener(e -&gt; dispose());&#10;&#10;        buttonPanel.add(btnGuardar);&#10;        buttonPanel.add(btnCancelar);&#10;&#10;        mainPanel.add(buttonPanel, BorderLayout.SOUTH);&#10;&#10;        add(mainPanel, BorderLayout.CENTER);&#10;&#10;        pack();&#10;        setMinimumSize(new Dimension(500, 580));&#10;    }&#10;&#10;    private void cargarDatos() {&#10;        if (anuncio != null) {&#10;            txtDescripcion.setText(anuncio.getDescripcion());&#10;            txtPrecio.setText(String.valueOf(anuncio.getPrecio()));&#10;            cboCategoria.setSelectedItem(anuncio.getCategoria());&#10;            txtEspecificacion.setText(anuncio.getEspecificacion());&#10;            txtUbicacion.setText(anuncio.getUbicacion());&#10;        }&#10;    }&#10;&#10;    private JLabel createLabel(String text) {&#10;        JLabel label = new JLabel(text);&#10;        label.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 13));&#10;        label.setForeground(new Color(60, 70, 90));&#10;        return label;&#10;    }&#10;&#10;    private void guardarCambios() {&#10;        // Obtener valores&#10;        String descripcion = txtDescripcion.getText().trim();&#10;        String precioStr = txtPrecio.getText().trim();&#10;        String categoria = (String) cboCategoria.getSelectedItem();&#10;        String especificacion = txtEspecificacion.getText().trim();&#10;        String ubicacion = txtUbicacion.getText().trim();&#10;&#10;        // Validar campos obligatorios&#10;        if (descripcion.isEmpty()) {&#10;            mostrarError(&quot;La descripción es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (precioStr.isEmpty()) {&#10;            mostrarError(&quot;El precio es obligatorio.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Validar que el precio sea numérico&#10;        Double precio;&#10;        try {&#10;            precio = Double.parseDouble(precioStr);&#10;            if (precio &lt;= 0) {&#10;                mostrarError(&quot;El precio debe ser mayor que cero.&quot;);&#10;                return;&#10;            }&#10;        } catch (NumberFormatException e) {&#10;            mostrarError(&quot;El precio debe ser un número válido.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (categoria == null || categoria.isEmpty()) {&#10;            mostrarError(&quot;Debes seleccionar una categoría.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (especificacion.isEmpty()) {&#10;            mostrarError(&quot;La especificación es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        if (ubicacion.isEmpty()) {&#10;            mostrarError(&quot;La ubicación es obligatoria.&quot;);&#10;            return;&#10;        }&#10;&#10;        // Intentar actualizar el anuncio&#10;        try {&#10;            boolean exito = api.updateAnuncio(anuncio.getId(), descripcion, precio, &#10;                                             categoria, especificacion, ubicacion);&#10;&#10;            System.out.println(&quot;Resultado de actualización: &quot; + exito + &quot; para ID: &quot; + anuncio.getId());&#10;&#10;            // Siempre cerrar el diálogo y recargar (aunque la API diga false, puede que haya funcionado)&#10;            dispose();&#10;            &#10;            // Recargar la lista de anuncios en el panel padre&#10;            if (empresaPanel != null) {&#10;                empresaPanel.recargarAnuncios();&#10;            }&#10;&#10;            // Mostrar mensaje de éxito solo si confirmamos que funcionó&#10;            if (exito) {&#10;                SwingUtilities.invokeLater(() -&gt; {&#10;                    JOptionPane.showMessageDialog(&#10;                        null,&#10;                        &quot;Anuncio actualizado correctamente.&quot;,&#10;                        &quot;Éxito&quot;,&#10;                        JOptionPane.INFORMATION_MESSAGE&#10;                    );&#10;                });&#10;            }&#10;        } catch (Exception ex) {&#10;            ex.printStackTrace();&#10;            mostrarError(&quot;Ocurrió un error al actualizar el anuncio: &quot; + ex.getMessage());&#10;        }&#10;    }&#10;&#10;    private void mostrarError(String mensaje) {&#10;        JOptionPane.showMessageDialog(&#10;            this,&#10;            mensaje,&#10;            &quot;Error de validación&quot;,&#10;            JOptionPane.ERROR_MESSAGE&#10;        );&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/icai/dtc/isw/ui/EmpresaPanel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/icai/dtc/isw/ui/EmpresaPanel.java" />
              <option name="originalContent" value="package icai.dtc.isw.ui;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;import icai.dtc.isw.domain.Empresa;&#10;import icai.dtc.isw.domain.User;&#10;&#10;import javax.swing.*;&#10;import javax.swing.border.EmptyBorder;&#10;import java.awt.*;&#10;import java.text.SimpleDateFormat;&#10;import java.util.List;&#10;&#10;public class EmpresaPanel extends JPanel {&#10;&#10;    private final EmpresaApi api = new EmpresaApi();&#10;    private final AnuncioApi anuncioApi = new AnuncioApi();&#10;    private final User currentUser;&#10;    private final String[] sectores;&#10;    private final AppMovilMock host; // referencia a la ventana para refrescar PERFIL&#10;&#10;    private JPanel contentCard;&#10;&#10;    public EmpresaPanel(User user, String[] sectores, AppMovilMock host) {&#10;        this.currentUser = user;&#10;        this.sectores = sectores.clone();&#10;        this.host = host;&#10;&#10;        setLayout(new BorderLayout());&#10;        setBackground(new Color(245, 247, 250));&#10;        setBorder(new EmptyBorder(12, 12, 12, 12));&#10;&#10;        contentCard = new JPanel(new BorderLayout());&#10;        contentCard.setBackground(Color.WHITE);&#10;        contentCard.setBorder(new UIUtils.RoundedBorder(16, new Color(230, 235, 245)));&#10;        add(contentCard, BorderLayout.CENTER);&#10;&#10;        cargarEstado();&#10;    }&#10;&#10;    private void cargarEstado() {&#10;        contentCard.removeAll();&#10;&#10;        String mail = safeEmail();&#10;        Empresa emp = api.getEmpresa(mail);&#10;&#10;        // Panel superior con título y botón&#10;        JPanel topPanel = new JPanel(new BorderLayout());&#10;        topPanel.setBackground(Color.WHITE);&#10;        topPanel.setBorder(new EmptyBorder(12, 12, 12, 12));&#10;&#10;        JLabel title = new JLabel(&quot;Mi Empresa&quot;, SwingConstants.LEFT);&#10;        title.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 20));&#10;        title.setForeground(new Color(20, 40, 80));&#10;        topPanel.add(title, BorderLayout.WEST);&#10;&#10;        if (emp == null) {&#10;            // No tiene perfil de empresa&#10;            JPanel centerPanel = new JPanel(new GridBagLayout());&#10;            centerPanel.setBackground(Color.WHITE);&#10;&#10;            JLabel info = new JLabel(&quot;Aún no has completado tu perfil de empresa.&quot;);&#10;            info.setForeground(new Color(95, 105, 125));&#10;&#10;            JButton btnCompletar = UIUtils.primaryButton(&quot;Completar perfil&quot;);&#10;            btnCompletar.addActionListener(e -&gt; mostrarFormulario());&#10;&#10;            GridBagConstraints gbc = UIUtils.baseGbc();&#10;            gbc.gridy = 0; gbc.insets = new Insets(4, 12, 8, 12); centerPanel.add(info, gbc);&#10;            gbc.gridy = 1; gbc.insets = new Insets(12, 12, 12, 12); centerPanel.add(btnCompletar, gbc);&#10;&#10;            contentCard.add(topPanel, BorderLayout.NORTH);&#10;            contentCard.add(centerPanel, BorderLayout.CENTER);&#10;        } else {&#10;            // Tiene perfil, mostrar botón y anuncios&#10;            JButton btnAnuncio = UIUtils.primaryButton(&quot;Poner anuncio&quot;);&#10;            btnAnuncio.addActionListener(e -&gt; abrirCrearAnuncio(emp));&#10;            topPanel.add(btnAnuncio, BorderLayout.EAST);&#10;&#10;            contentCard.add(topPanel, BorderLayout.NORTH);&#10;&#10;            // Cargar y mostrar anuncios&#10;            cargarAnuncios(emp.getNif());&#10;        }&#10;&#10;        contentCard.revalidate();&#10;        contentCard.repaint();&#10;    }&#10;&#10;    private void mostrarFormulario() {&#10;        JTextField txtNombre    = UIUtils.styledTextField(22);&#10;        JTextField txtNif       = UIUtils.styledTextField(22);&#10;        JComboBox&lt;String&gt; cboSector = UIUtils.styledCombo(sectores);&#10;        JTextField txtUbicacion = UIUtils.styledTextField(22);&#10;&#10;        if (cboSector.getItemCount() &gt; 0) cboSector.setSelectedIndex(0);&#10;&#10;        JPanel form = new JPanel(new GridBagLayout());&#10;        form.setBorder(new EmptyBorder(8,8,8,8));&#10;        form.setBackground(Color.WHITE);&#10;&#10;        GridBagConstraints gbc = UIUtils.baseGbc();&#10;        gbc.gridy=0; form.add(new JLabel(&quot;Nombre de la empresa:&quot;), gbc);&#10;        gbc.gridy=1; form.add(txtNombre, gbc);&#10;        gbc.gridy=2; form.add(new JLabel(&quot;NIF/CIF:&quot;), gbc);&#10;        gbc.gridy=3; form.add(txtNif, gbc);&#10;        gbc.gridy=4; form.add(new JLabel(&quot;Sector:&quot;), gbc);&#10;        gbc.gridy=5; form.add(cboSector, gbc);&#10;        gbc.gridy=6; form.add(new JLabel(&quot;Ubicación:&quot;), gbc);&#10;        gbc.gridy=7; form.add(txtUbicacion, gbc);&#10;&#10;        int r = JOptionPane.showConfirmDialog(&#10;                this, form, &quot;Completar perfil de empresa&quot;,&#10;                JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;&#10;        if (r == JOptionPane.OK_OPTION) {&#10;            String nombre    = txtNombre.getText().trim();&#10;            String nif       = txtNif.getText().trim();&#10;            String sector    = (String) cboSector.getSelectedItem();&#10;            String ubicacion = txtUbicacion.getText().trim();&#10;&#10;            if (nombre.isEmpty() || nif.isEmpty() || sector == null || sector.isBlank() || ubicacion.isEmpty()) {&#10;                JOptionPane.showMessageDialog(this, &quot;Rellena todos los campos.&quot;, &quot;Validación&quot;, JOptionPane.WARNING_MESSAGE);&#10;                return;&#10;            }&#10;&#10;            boolean ok = api.saveEmpresa(safeEmail(), nombre, nif, sector, ubicacion);&#10;            if (ok) {&#10;                JOptionPane.showMessageDialog(this, &quot;Perfil guardado correctamente.&quot;, &quot;Mi Empresa&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;&#10;                //  Notificar al host para que reconstruya la tarjeta PERFIL y navegar allí&#10;                if (host != null) {&#10;                    host.refreshPerfil();&#10;                    host.showPerfil();&#10;                }&#10;&#10;                cargarEstado(); // Este panel pasa a mostrar &quot;Poner anuncio&quot;&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;No se pudo guardar el perfil.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        }&#10;    }&#10;&#10;    private String safeEmail() {&#10;        try { return (String) currentUser.getClass().getMethod(&quot;getEmail&quot;).invoke(currentUser); }&#10;        catch (Exception e) { return null; }&#10;    }&#10;&#10;    private void abrirCrearAnuncio(Empresa emp) {&#10;        // Obtener el Frame padre&#10;        Frame parentFrame = (Frame) SwingUtilities.getWindowAncestor(this);&#10;&#10;        // Crear y mostrar el diálogo&#10;        CrearAnuncioPanel dialog = new CrearAnuncioPanel(parentFrame, emp, host);&#10;        dialog.setVisible(true);&#10;&#10;        // Después de cerrar el diálogo, recargar los anuncios&#10;        cargarEstado();&#10;    }&#10;&#10;    private void cargarAnuncios(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = anuncioApi.getAnunciosByEmpresa(nifEmpresa);&#10;&#10;        JPanel anunciosPanel = new JPanel();&#10;        anunciosPanel.setLayout(new BoxLayout(anunciosPanel, BoxLayout.Y_AXIS));&#10;        anunciosPanel.setBackground(Color.WHITE);&#10;        anunciosPanel.setBorder(new EmptyBorder(0, 12, 12, 12));&#10;&#10;        if (anuncios == null || anuncios.isEmpty()) {&#10;            // No hay anuncios&#10;            JLabel noAnuncios = new JLabel(&quot;No tienes anuncios publicados aún.&quot;);&#10;            noAnuncios.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 14));&#10;            noAnuncios.setForeground(new Color(120, 130, 150));&#10;            noAnuncios.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;            noAnuncios.setBorder(new EmptyBorder(20, 0, 20, 0));&#10;            anunciosPanel.add(noAnuncios);&#10;        } else {&#10;            // Mostrar anuncios en tarjetas&#10;            for (Anuncio anuncio : anuncios) {&#10;                anunciosPanel.add(crearTarjetaAnuncio(anuncio));&#10;                anunciosPanel.add(Box.createRigidArea(new Dimension(0, 12))); // Espacio entre tarjetas&#10;            }&#10;        }&#10;&#10;        // Envolver en JScrollPane&#10;        JScrollPane scrollPane = new JScrollPane(anunciosPanel);&#10;        scrollPane.setBorder(null);&#10;        scrollPane.setBackground(Color.WHITE);&#10;        scrollPane.getVerticalScrollBar().setUnitIncrement(16);&#10;&#10;        contentCard.add(scrollPane, BorderLayout.CENTER);&#10;    }&#10;&#10;    private JPanel crearTarjetaAnuncio(Anuncio anuncio) {&#10;        JPanel tarjeta = new JPanel(new BorderLayout(12, 8));&#10;        tarjeta.setBackground(new Color(250, 252, 255));&#10;        tarjeta.setBorder(BorderFactory.createCompoundBorder(&#10;            new UIUtils.RoundedBorder(12, new Color(220, 230, 245)),&#10;            new EmptyBorder(16, 16, 16, 16)&#10;        ));&#10;        tarjeta.setMaximumSize(new Dimension(Integer.MAX_VALUE, 280));&#10;&#10;        // Panel izquierdo con la información principal&#10;        JPanel infoPanel = new JPanel();&#10;        infoPanel.setLayout(new BoxLayout(infoPanel, BoxLayout.Y_AXIS));&#10;        infoPanel.setBackground(new Color(250, 252, 255));&#10;&#10;        // Categoría (pequeña, arriba)&#10;        JLabel lblCategoria = new JLabel(&quot; &quot; + anuncio.getCategoria());&#10;        lblCategoria.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 11));&#10;        lblCategoria.setForeground(new Color(80, 120, 200));&#10;        lblCategoria.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Descripción (destacada)&#10;        String descripcionCorta = anuncio.getDescripcion().length() &gt; 80&#10;            ? anuncio.getDescripcion().substring(0, 80) + &quot;...&quot;&#10;            : anuncio.getDescripcion();&#10;        JLabel lblDescripcion = new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + descripcionCorta + &quot;&lt;/b&gt;&lt;/html&gt;&quot;);&#10;        lblDescripcion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 14));&#10;        lblDescripcion.setForeground(new Color(30, 40, 60));&#10;        lblDescripcion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Especificación&#10;        JLabel lblEspecificacion = new JLabel(&quot; &quot; + anuncio.getEspecificacion());&#10;        lblEspecificacion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 12));&#10;        lblEspecificacion.setForeground(new Color(90, 100, 120));&#10;        lblEspecificacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Ubicación&#10;        JLabel lblUbicacion = new JLabel(&quot; &quot; + anuncio.getUbicacion());&#10;        lblUbicacion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 12));&#10;        lblUbicacion.setForeground(new Color(90, 100, 120));&#10;        lblUbicacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Fecha de publicación&#10;        SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;);&#10;        String fechaPublicacion = &quot;&quot;;&#10;        if (anuncio.getCreadoEn() != null) {&#10;            fechaPublicacion = &quot; Publicado: &quot; + sdf.format(anuncio.getCreadoEn());&#10;        }&#10;        JLabel lblFechaPublicacion = new JLabel(fechaPublicacion);&#10;        lblFechaPublicacion.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 11));&#10;        lblFechaPublicacion.setForeground(new Color(120, 130, 150));&#10;        lblFechaPublicacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Fecha de actualización&#10;        String fechaActualizacion = &quot;&quot;;&#10;        if (anuncio.getActualizadoEn() != null) {&#10;            fechaActualizacion = &quot; Actualizado: &quot; + sdf.format(anuncio.getActualizadoEn());&#10;        }&#10;        JLabel lblFechaActualizacion = new JLabel(fechaActualizacion);&#10;        lblFechaActualizacion.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 11));&#10;        lblFechaActualizacion.setForeground(new Color(120, 130, 150));&#10;        lblFechaActualizacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        infoPanel.add(lblCategoria);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 6)));&#10;        infoPanel.add(lblDescripcion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        infoPanel.add(lblEspecificacion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 4)));&#10;        infoPanel.add(lblUbicacion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        infoPanel.add(lblFechaPublicacion);&#10;        if (!fechaActualizacion.isEmpty()) {&#10;            infoPanel.add(Box.createRigidArea(new Dimension(0, 2)));&#10;            infoPanel.add(lblFechaActualizacion);&#10;        }&#10;&#10;        // Panel derecho con precio y botones&#10;        JPanel derechaPanel = new JPanel();&#10;        derechaPanel.setLayout(new BoxLayout(derechaPanel, BoxLayout.Y_AXIS));&#10;        derechaPanel.setBackground(new Color(250, 252, 255));&#10;        derechaPanel.setPreferredSize(new Dimension(120, 100));&#10;&#10;        JLabel lblPrecio = new JLabel(String.format(&quot;%.2f €&quot;, anuncio.getPrecio()));&#10;        lblPrecio.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 24));&#10;        lblPrecio.setForeground(new Color(20, 120, 80));&#10;        lblPrecio.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;&#10;        // Botón Eliminar&#10;        JButton btnEliminar = UIUtils.dangerButton(&quot;️ Eliminar&quot;);&#10;        btnEliminar.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;        btnEliminar.setPreferredSize(new Dimension(110, 35));&#10;        btnEliminar.setMaximumSize(new Dimension(110, 35));&#10;        btnEliminar.addActionListener(e -&gt; {&#10;            int confirmacion = JOptionPane.showConfirmDialog(&#10;                this,&#10;                &quot;¿Estás seguro de que deseas eliminar este anuncio?&quot;,&#10;                &quot;Confirmar eliminación&quot;,&#10;                JOptionPane.YES_NO_OPTION,&#10;                JOptionPane.WARNING_MESSAGE&#10;            );&#10;&#10;            if (confirmacion == JOptionPane.YES_OPTION) {&#10;                boolean ok = anuncioApi.deleteAnuncio(anuncio.getId());&#10;                if (ok) {&#10;                    JOptionPane.showMessageDialog(&#10;                        this,&#10;                        &quot;Anuncio eliminado correctamente.&quot;,&#10;                        &quot;Éxito&quot;,&#10;                        JOptionPane.INFORMATION_MESSAGE&#10;                    );&#10;                    cargarEstado(); // Recargar la lista&#10;                } else {&#10;                    JOptionPane.showMessageDialog(&#10;                        this,&#10;                        &quot;No se pudo eliminar el anuncio.&quot;,&#10;                        &quot;Error&quot;,&#10;                        JOptionPane.ERROR_MESSAGE&#10;                    );&#10;                }&#10;            }&#10;        });&#10;&#10;        // Botón Editar&#10;        JButton btnEditar = UIUtils.secondaryButton(&quot;✏️ Editar&quot;);&#10;        btnEditar.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;        btnEditar.setPreferredSize(new Dimension(110, 35));&#10;        btnEditar.setMaximumSize(new Dimension(110, 35));&#10;        btnEditar.addActionListener(e -&gt; {&#10;            Frame parentFrame = (Frame) SwingUtilities.getWindowAncestor(this);&#10;            EditarAnuncioPanel dialog = new EditarAnuncioPanel(parentFrame, anuncio);&#10;            dialog.setVisible(true);&#10;            cargarEstado(); // Recargar la lista después de editar&#10;        });&#10;&#10;        derechaPanel.add(lblPrecio);&#10;        derechaPanel.add(Box.createRigidArea(new Dimension(0, 12)));&#10;        derechaPanel.add(btnEliminar);&#10;        derechaPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        derechaPanel.add(btnEditar);&#10;&#10;        tarjeta.add(infoPanel, BorderLayout.CENTER);&#10;        tarjeta.add(derechaPanel, BorderLayout.EAST);&#10;&#10;        return tarjeta;&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package icai.dtc.isw.ui;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;import icai.dtc.isw.domain.Empresa;&#10;import icai.dtc.isw.domain.User;&#10;&#10;import javax.swing.*;&#10;import javax.swing.border.EmptyBorder;&#10;import java.awt.*;&#10;import java.text.SimpleDateFormat;&#10;import java.util.List;&#10;&#10;public class EmpresaPanel extends JPanel {&#10;&#10;    private final EmpresaApi api = new EmpresaApi();&#10;    private final AnuncioApi anuncioApi = new AnuncioApi();&#10;    private final User currentUser;&#10;    private final String[] sectores;&#10;    private final AppMovilMock host; // referencia a la ventana para refrescar PERFIL&#10;&#10;    private JPanel contentCard;&#10;&#10;    public EmpresaPanel(User user, String[] sectores, AppMovilMock host) {&#10;        this.currentUser = user;&#10;        this.sectores = sectores.clone();&#10;        this.host = host;&#10;&#10;        setLayout(new BorderLayout());&#10;        setBackground(new Color(245, 247, 250));&#10;        setBorder(new EmptyBorder(12, 12, 12, 12));&#10;&#10;        contentCard = new JPanel(new BorderLayout());&#10;        contentCard.setBackground(Color.WHITE);&#10;        contentCard.setBorder(new UIUtils.RoundedBorder(16, new Color(230, 235, 245)));&#10;        add(contentCard, BorderLayout.CENTER);&#10;&#10;        cargarEstado();&#10;    }&#10;&#10;    private void cargarEstado() {&#10;        contentCard.removeAll();&#10;&#10;        String mail = safeEmail();&#10;        Empresa emp = api.getEmpresa(mail);&#10;&#10;        // Panel superior con título y botón&#10;        JPanel topPanel = new JPanel(new BorderLayout());&#10;        topPanel.setBackground(Color.WHITE);&#10;        topPanel.setBorder(new EmptyBorder(12, 12, 12, 12));&#10;&#10;        JLabel title = new JLabel(&quot;Mi Empresa&quot;, SwingConstants.LEFT);&#10;        title.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 20));&#10;        title.setForeground(new Color(20, 40, 80));&#10;        topPanel.add(title, BorderLayout.WEST);&#10;&#10;        if (emp == null) {&#10;            // No tiene perfil de empresa&#10;            JPanel centerPanel = new JPanel(new GridBagLayout());&#10;            centerPanel.setBackground(Color.WHITE);&#10;&#10;            JLabel info = new JLabel(&quot;Aún no has completado tu perfil de empresa.&quot;);&#10;            info.setForeground(new Color(95, 105, 125));&#10;&#10;            JButton btnCompletar = UIUtils.primaryButton(&quot;Completar perfil&quot;);&#10;            btnCompletar.addActionListener(e -&gt; mostrarFormulario());&#10;&#10;            GridBagConstraints gbc = UIUtils.baseGbc();&#10;            gbc.gridy = 0; gbc.insets = new Insets(4, 12, 8, 12); centerPanel.add(info, gbc);&#10;            gbc.gridy = 1; gbc.insets = new Insets(12, 12, 12, 12); centerPanel.add(btnCompletar, gbc);&#10;&#10;            contentCard.add(topPanel, BorderLayout.NORTH);&#10;            contentCard.add(centerPanel, BorderLayout.CENTER);&#10;        } else {&#10;            // Tiene perfil, mostrar botón y anuncios&#10;            JButton btnAnuncio = UIUtils.primaryButton(&quot;Poner anuncio&quot;);&#10;            btnAnuncio.addActionListener(e -&gt; abrirCrearAnuncio(emp));&#10;            topPanel.add(btnAnuncio, BorderLayout.EAST);&#10;&#10;            contentCard.add(topPanel, BorderLayout.NORTH);&#10;&#10;            // Cargar y mostrar anuncios&#10;            cargarAnuncios(emp.getNif());&#10;        }&#10;&#10;        contentCard.revalidate();&#10;        contentCard.repaint();&#10;    }&#10;&#10;    private void mostrarFormulario() {&#10;        JTextField txtNombre    = UIUtils.styledTextField(22);&#10;        JTextField txtNif       = UIUtils.styledTextField(22);&#10;        JComboBox&lt;String&gt; cboSector = UIUtils.styledCombo(sectores);&#10;        JTextField txtUbicacion = UIUtils.styledTextField(22);&#10;&#10;        if (cboSector.getItemCount() &gt; 0) cboSector.setSelectedIndex(0);&#10;&#10;        JPanel form = new JPanel(new GridBagLayout());&#10;        form.setBorder(new EmptyBorder(8,8,8,8));&#10;        form.setBackground(Color.WHITE);&#10;&#10;        GridBagConstraints gbc = UIUtils.baseGbc();&#10;        gbc.gridy=0; form.add(new JLabel(&quot;Nombre de la empresa:&quot;), gbc);&#10;        gbc.gridy=1; form.add(txtNombre, gbc);&#10;        gbc.gridy=2; form.add(new JLabel(&quot;NIF/CIF:&quot;), gbc);&#10;        gbc.gridy=3; form.add(txtNif, gbc);&#10;        gbc.gridy=4; form.add(new JLabel(&quot;Sector:&quot;), gbc);&#10;        gbc.gridy=5; form.add(cboSector, gbc);&#10;        gbc.gridy=6; form.add(new JLabel(&quot;Ubicación:&quot;), gbc);&#10;        gbc.gridy=7; form.add(txtUbicacion, gbc);&#10;&#10;        int r = JOptionPane.showConfirmDialog(&#10;                this, form, &quot;Completar perfil de empresa&quot;,&#10;                JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;&#10;        if (r == JOptionPane.OK_OPTION) {&#10;            String nombre    = txtNombre.getText().trim();&#10;            String nif       = txtNif.getText().trim();&#10;            String sector    = (String) cboSector.getSelectedItem();&#10;            String ubicacion = txtUbicacion.getText().trim();&#10;&#10;            if (nombre.isEmpty() || nif.isEmpty() || sector == null || sector.isBlank() || ubicacion.isEmpty()) {&#10;                JOptionPane.showMessageDialog(this, &quot;Rellena todos los campos.&quot;, &quot;Validación&quot;, JOptionPane.WARNING_MESSAGE);&#10;                return;&#10;            }&#10;&#10;            boolean ok = api.saveEmpresa(safeEmail(), nombre, nif, sector, ubicacion);&#10;            if (ok) {&#10;                JOptionPane.showMessageDialog(this, &quot;Perfil guardado correctamente.&quot;, &quot;Mi Empresa&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;&#10;                //  Notificar al host para que reconstruya la tarjeta PERFIL y navegar allí&#10;                if (host != null) {&#10;                    host.refreshPerfil();&#10;                    host.showPerfil();&#10;                }&#10;&#10;                cargarEstado(); // Este panel pasa a mostrar &quot;Poner anuncio&quot;&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;No se pudo guardar el perfil.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        }&#10;    }&#10;&#10;    private String safeEmail() {&#10;        try { return (String) currentUser.getClass().getMethod(&quot;getEmail&quot;).invoke(currentUser); }&#10;        catch (Exception e) { return null; }&#10;    }&#10;&#10;    private void abrirCrearAnuncio(Empresa emp) {&#10;        // Obtener el Frame padre&#10;        Frame parentFrame = (Frame) SwingUtilities.getWindowAncestor(this);&#10;&#10;        // Crear y mostrar el diálogo&#10;        CrearAnuncioPanel dialog = new CrearAnuncioPanel(parentFrame, emp, host);&#10;        dialog.setVisible(true);&#10;&#10;        // Después de cerrar el diálogo, recargar los anuncios&#10;        cargarEstado();&#10;    }&#10;&#10;    private void cargarAnuncios(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = anuncioApi.getAnunciosByEmpresa(nifEmpresa);&#10;&#10;        JPanel anunciosPanel = new JPanel();&#10;        anunciosPanel.setLayout(new BoxLayout(anunciosPanel, BoxLayout.Y_AXIS));&#10;        anunciosPanel.setBackground(Color.WHITE);&#10;        anunciosPanel.setBorder(new EmptyBorder(0, 12, 12, 12));&#10;&#10;        if (anuncios == null || anuncios.isEmpty()) {&#10;            // No hay anuncios&#10;            JLabel noAnuncios = new JLabel(&quot;No tienes anuncios publicados aún.&quot;);&#10;            noAnuncios.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 14));&#10;            noAnuncios.setForeground(new Color(120, 130, 150));&#10;            noAnuncios.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;            noAnuncios.setBorder(new EmptyBorder(20, 0, 20, 0));&#10;            anunciosPanel.add(noAnuncios);&#10;        } else {&#10;            // Mostrar anuncios en tarjetas&#10;            for (Anuncio anuncio : anuncios) {&#10;                anunciosPanel.add(crearTarjetaAnuncio(anuncio));&#10;                anunciosPanel.add(Box.createRigidArea(new Dimension(0, 12))); // Espacio entre tarjetas&#10;            }&#10;        }&#10;&#10;        // Envolver en JScrollPane&#10;        JScrollPane scrollPane = new JScrollPane(anunciosPanel);&#10;        scrollPane.setBorder(null);&#10;        scrollPane.setBackground(Color.WHITE);&#10;        scrollPane.getVerticalScrollBar().setUnitIncrement(16);&#10;&#10;        contentCard.add(scrollPane, BorderLayout.CENTER);&#10;    }&#10;&#10;    private JPanel crearTarjetaAnuncio(Anuncio anuncio) {&#10;        JPanel tarjeta = new JPanel(new BorderLayout(12, 8));&#10;        tarjeta.setBackground(new Color(250, 252, 255));&#10;        tarjeta.setBorder(BorderFactory.createCompoundBorder(&#10;            new UIUtils.RoundedBorder(12, new Color(220, 230, 245)),&#10;            new EmptyBorder(16, 16, 16, 16)&#10;        ));&#10;        tarjeta.setMaximumSize(new Dimension(Integer.MAX_VALUE, 280));&#10;&#10;        // Panel izquierdo con la información principal&#10;        JPanel infoPanel = new JPanel();&#10;        infoPanel.setLayout(new BoxLayout(infoPanel, BoxLayout.Y_AXIS));&#10;        infoPanel.setBackground(new Color(250, 252, 255));&#10;&#10;        // Categoría (pequeña, arriba)&#10;        JLabel lblCategoria = new JLabel(&quot; &quot; + anuncio.getCategoria());&#10;        lblCategoria.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 11));&#10;        lblCategoria.setForeground(new Color(80, 120, 200));&#10;        lblCategoria.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Descripción (destacada)&#10;        String descripcionCorta = anuncio.getDescripcion().length() &gt; 80&#10;            ? anuncio.getDescripcion().substring(0, 80) + &quot;...&quot;&#10;            : anuncio.getDescripcion();&#10;        JLabel lblDescripcion = new JLabel(&quot;&lt;html&gt;&lt;b&gt;&quot; + descripcionCorta + &quot;&lt;/b&gt;&lt;/html&gt;&quot;);&#10;        lblDescripcion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 14));&#10;        lblDescripcion.setForeground(new Color(30, 40, 60));&#10;        lblDescripcion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Especificación&#10;        JLabel lblEspecificacion = new JLabel(&quot; &quot; + anuncio.getEspecificacion());&#10;        lblEspecificacion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 12));&#10;        lblEspecificacion.setForeground(new Color(90, 100, 120));&#10;        lblEspecificacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Ubicación&#10;        JLabel lblUbicacion = new JLabel(&quot; &quot; + anuncio.getUbicacion());&#10;        lblUbicacion.setFont(new Font(&quot;SansSerif&quot;, Font.PLAIN, 12));&#10;        lblUbicacion.setForeground(new Color(90, 100, 120));&#10;        lblUbicacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Fecha de publicación&#10;        SimpleDateFormat sdf = new SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;);&#10;        String fechaPublicacion = &quot;&quot;;&#10;        if (anuncio.getCreadoEn() != null) {&#10;            fechaPublicacion = &quot; Publicado: &quot; + sdf.format(anuncio.getCreadoEn());&#10;        }&#10;        JLabel lblFechaPublicacion = new JLabel(fechaPublicacion);&#10;        lblFechaPublicacion.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 11));&#10;        lblFechaPublicacion.setForeground(new Color(120, 130, 150));&#10;        lblFechaPublicacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        // Fecha de actualización&#10;        String fechaActualizacion = &quot;&quot;;&#10;        if (anuncio.getActualizadoEn() != null) {&#10;            fechaActualizacion = &quot; Actualizado: &quot; + sdf.format(anuncio.getActualizadoEn());&#10;        }&#10;        JLabel lblFechaActualizacion = new JLabel(fechaActualizacion);&#10;        lblFechaActualizacion.setFont(new Font(&quot;SansSerif&quot;, Font.ITALIC, 11));&#10;        lblFechaActualizacion.setForeground(new Color(120, 130, 150));&#10;        lblFechaActualizacion.setAlignmentX(Component.LEFT_ALIGNMENT);&#10;&#10;        infoPanel.add(lblCategoria);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 6)));&#10;        infoPanel.add(lblDescripcion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        infoPanel.add(lblEspecificacion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 4)));&#10;        infoPanel.add(lblUbicacion);&#10;        infoPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        infoPanel.add(lblFechaPublicacion);&#10;        if (!fechaActualizacion.isEmpty()) {&#10;            infoPanel.add(Box.createRigidArea(new Dimension(0, 2)));&#10;            infoPanel.add(lblFechaActualizacion);&#10;        }&#10;&#10;        // Panel derecho con precio y botones&#10;        JPanel derechaPanel = new JPanel();&#10;        derechaPanel.setLayout(new BoxLayout(derechaPanel, BoxLayout.Y_AXIS));&#10;        derechaPanel.setBackground(new Color(250, 252, 255));&#10;        derechaPanel.setPreferredSize(new Dimension(120, 100));&#10;&#10;        JLabel lblPrecio = new JLabel(String.format(&quot;%.2f €&quot;, anuncio.getPrecio()));&#10;        lblPrecio.setFont(new Font(&quot;SansSerif&quot;, Font.BOLD, 24));&#10;        lblPrecio.setForeground(new Color(20, 120, 80));&#10;        lblPrecio.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;&#10;        // Botón Eliminar&#10;        JButton btnEliminar = UIUtils.dangerButton(&quot;️ Eliminar&quot;);&#10;        btnEliminar.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;        btnEliminar.setPreferredSize(new Dimension(110, 35));&#10;        btnEliminar.setMaximumSize(new Dimension(110, 35));&#10;        btnEliminar.addActionListener(e -&gt; {&#10;            int confirmacion = JOptionPane.showConfirmDialog(&#10;                this,&#10;                &quot;¿Estás seguro de que deseas eliminar este anuncio?&quot;,&#10;                &quot;Confirmar eliminación&quot;,&#10;                JOptionPane.YES_NO_OPTION,&#10;                JOptionPane.WARNING_MESSAGE&#10;            );&#10;            &#10;            if (confirmacion == JOptionPane.YES_OPTION) {&#10;                // Ejecutar eliminación en un hilo separado para no bloquear la UI&#10;                new Thread(() -&gt; {&#10;                    try {&#10;                        boolean ok = anuncioApi.deleteAnuncio(anuncio.getId());&#10;                        System.out.println(&quot;Resultado de eliminación: &quot; + ok + &quot; para ID: &quot; + anuncio.getId());&#10;                        &#10;                        // Siempre recargar la lista en el EDT (aunque la API diga false, puede que haya funcionado)&#10;                        SwingUtilities.invokeLater(() -&gt; {&#10;                            cargarEstado();&#10;                            // Mostrar mensaje solo si realmente no se eliminó (verificando la nueva lista)&#10;                        });&#10;                    } catch (Exception ex) {&#10;                        ex.printStackTrace();&#10;                        SwingUtilities.invokeLater(() -&gt; {&#10;                            JOptionPane.showMessageDialog(&#10;                                EmpresaPanel.this,&#10;                                &quot;Error al eliminar el anuncio: &quot; + ex.getMessage(),&#10;                                &quot;Error&quot;,&#10;                                JOptionPane.ERROR_MESSAGE&#10;                            );&#10;                        });&#10;                    }&#10;                }).start();&#10;            }&#10;        });&#10;&#10;        // Botón Editar&#10;        JButton btnEditar = UIUtils.secondaryButton(&quot;✏️ Editar&quot;);&#10;        btnEditar.setAlignmentX(Component.CENTER_ALIGNMENT);&#10;        btnEditar.setPreferredSize(new Dimension(110, 35));&#10;        btnEditar.setMaximumSize(new Dimension(110, 35));&#10;        btnEditar.addActionListener(e -&gt; {&#10;            Frame parentFrame = (Frame) SwingUtilities.getWindowAncestor(this);&#10;            EditarAnuncioPanel dialog = new EditarAnuncioPanel(parentFrame, anuncio, this);&#10;            dialog.setVisible(true);&#10;            // El diálogo llamará a recargarAnuncios() después de editar&#10;        });&#10;&#10;        derechaPanel.add(lblPrecio);&#10;        derechaPanel.add(Box.createRigidArea(new Dimension(0, 12)));&#10;        derechaPanel.add(btnEliminar);&#10;        derechaPanel.add(Box.createRigidArea(new Dimension(0, 8)));&#10;        derechaPanel.add(btnEditar);&#10;&#10;        tarjeta.add(infoPanel, BorderLayout.CENTER);&#10;        tarjeta.add(derechaPanel, BorderLayout.EAST);&#10;&#10;        return tarjeta;&#10;    }&#10;&#10;    /**&#10;     * Método público para recargar los anuncios desde componentes externos&#10;     */&#10;    public void recargarAnuncios() {&#10;        SwingUtilities.invokeLater(() -&gt; cargarEstado());&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>