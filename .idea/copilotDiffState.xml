<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/ANUNCIOS_README.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/ANUNCIOS_README.md" />
              <option name="originalContent" value="# Documentación del Flujo de Creación de Anuncios&#10;&#10;## Descripción General&#10;&#10;Se ha implementado un flujo completo para crear anuncios en la aplicación Java Swing, siguiendo el patrón MVC y utilizando la infraestructura de comunicación cliente-servidor existente.&#10;&#10;## Componentes Implementados&#10;&#10;### 1. Modelo de Dominio&#10;- **Archivo**: `src/main/java/icai/dtc/isw/domain/Anuncio.java`&#10;- **Descripción**: Clase que representa un anuncio con todos sus atributos.&#10;- **Campos**:&#10;  - `id` (String): Identificador único (UUID)&#10;  - `descripcion` (String): Descripción del anuncio&#10;  - `precio` (Double): Precio del servicio/producto&#10;  - `categoria` (String): Categoría del anuncio&#10;  - `especificacion` (String): Especificaciones adicionales&#10;  - `ubicacion` (String): Ubicación del servicio/producto&#10;  - `nifEmpresa` (String): NIF de la empresa que publica&#10;  - `creadoEn` (Timestamp): Fecha de creación&#10;  - `actualizadoEn` (Timestamp): Fecha de última actualización&#10;&#10;### 2. Capa de Acceso a Datos (DAO)&#10;- **Archivo**: `src/main/java/icai/dtc/isw/dao/AnuncioDAO.java`&#10;- **Métodos principales**:&#10;  - `insert(Anuncio)`: Inserta un nuevo anuncio&#10;  - `findById(String)`: Busca un anuncio por ID&#10;  - `findByNifEmpresa(String)`: Lista anuncios de una empresa&#10;  - `findAll()`: Lista todos los anuncios&#10;&#10;### 3. Controlador&#10;- **Archivo**: `src/main/java/icai/dtc/isw/controler/AnuncioControler.java`&#10;- **Métodos principales**:&#10;  - `createAnuncio(...)`: Crea un anuncio con validaciones&#10;  - `getAnuncio(String)`: Obtiene un anuncio por ID&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;  - `getAllAnuncios()`: Lista todos los anuncios&#10;&#10;### 4. API del Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/AnuncioApi.java`&#10;- **Descripción**: Interfaz para comunicarse con el servidor mediante sockets.&#10;- **Métodos**:&#10;  - `createAnuncio(...)`: Envía petición para crear un anuncio&#10;  - `getAnuncio(String)`: Obtiene un anuncio del servidor&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;&#10;### 5. Interfaz de Usuario&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/CrearAnuncioPanel.java`&#10;- **Descripción**: Diálogo modal para crear un nuevo anuncio.&#10;- **Campos del formulario**:&#10;  - Descripción (área de texto)&#10;  - Precio (campo numérico)&#10;  - Categoría (ComboBox con opciones predefinidas)&#10;  - Especificación (campo de texto)&#10;  - Ubicación (campo de texto)&#10;  - NIF Empresa (campo de solo lectura, auto-rellenado)&#10;&#10;### 6. Integración en EmpresaPanel&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/EmpresaPanel.java`&#10;- **Cambios**: El botón &quot;Poner anuncio&quot; ahora abre el diálogo `CrearAnuncioPanel`.&#10;&#10;### 7. Servidor&#10;- **Archivo**: `src/main/java/icai/dtc/isw/server/SocketServer.java`&#10;- **Endpoints añadidos**:&#10;  - `/anuncio/create`: Crea un nuevo anuncio&#10;  - `/anuncio/get`: Obtiene un anuncio por ID&#10;  - `/anuncio/list`: Lista anuncios de una empresa&#10;&#10;### 8. Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/client/Client.java`&#10;- **Cambios**: Añadidos casos para manejar las respuestas del servidor:&#10;  - `/anuncioCreateResponse`&#10;  - `/anuncioGetResponse`&#10;  - `/anuncioListResponse`&#10;&#10;## Instalación y Configuración&#10;&#10;### 1. Base de Datos&#10;&#10;Ejecuta el script SQL en tu base de datos PostgreSQL de AWS:&#10;&#10;```bash&#10;psql -h ec2-13-60-40-17.eu-north-1.compute.amazonaws.com -U postgres -d postgres -f src/main/resources/create_anuncio_table.sql&#10;```&#10;&#10;O conéctate manualmente y ejecuta el contenido del archivo `create_anuncio_table.sql`.&#10;&#10;### 2. Compilación&#10;&#10;Compila el proyecto usando Maven:&#10;&#10;```bash&#10;mvn clean compile&#10;```&#10;&#10;### 3. Ejecución&#10;&#10;1. **Iniciar el servidor**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.server.SocketServer&#10;   ```&#10;&#10;2. **Iniciar el cliente**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.ui.AppMovilMock&#10;   ```&#10;&#10;## Flujo de Uso&#10;&#10;1. El usuario inicia sesión en la aplicación.&#10;2. Navega a &quot;Mi Empresa&quot;.&#10;3. Si ya tiene el perfil de empresa completado, verá el botón &quot;Poner anuncio&quot;.&#10;4. Al hacer clic en &quot;Poner anuncio&quot;, se abre un diálogo modal.&#10;5. Rellena todos los campos obligatorios:&#10;   - **Descripción**: Texto largo describiendo el anuncio&#10;   - **Precio**: Valor numérico (ej: 99.99)&#10;   - **Categoría**: Selección de una lista desplegable&#10;   - **Especificación**: Detalles adicionales&#10;   - **Ubicación**: Dónde se ofrece el servicio/producto&#10;   - **NIF Empresa**: Auto-rellenado (solo lectura)&#10;6. Hace clic en &quot;Crear anuncio&quot;.&#10;7. El sistema valida los campos:&#10;   - Ningún campo puede estar vacío&#10;   - El precio debe ser un número válido mayor que cero&#10;8. Si todo es correcto, se envía al servidor.&#10;9. El servidor crea el anuncio en la base de datos.&#10;10. Se muestra un mensaje de éxito y se cierra el diálogo.&#10;&#10;## Validaciones Implementadas&#10;&#10;### En el Cliente (CrearAnuncioPanel)&#10;- Campos obligatorios no pueden estar vacíos&#10;- El precio debe ser un número válido&#10;- El precio debe ser mayor que cero&#10;&#10;### En el Controlador (AnuncioControler)&#10;- Validación de campos nulos o vacíos&#10;- Validación de precio positivo&#10;- Generación automática de UUID para el ID&#10;&#10;### En la Base de Datos&#10;- Restricción CHECK para precio &gt; 0&#10;- Clave foránea hacia la tabla empresa&#10;- Timestamps automáticos para creado_en y actualizado_en&#10;- Trigger para actualizar actualizado_en automáticamente&#10;&#10;## Categorías Disponibles&#10;&#10;1. Hogar y reparaciones&#10;2. Salud, belleza y cuidados&#10;3. Educación y cultura&#10;4. Eventos y ocio&#10;5. Negocio y administración&#10;6. Logística y movilidad&#10;7. Tecnología y digital&#10;&#10;## Estructura de la Tabla en PostgreSQL&#10;&#10;```sql&#10;CREATE TABLE anuncio (&#10;    id VARCHAR(255) PRIMARY KEY,&#10;    descripcion TEXT NOT NULL,&#10;    precio DECIMAL(10, 2) NOT NULL CHECK (precio &gt; 0),&#10;    categoria VARCHAR(100) NOT NULL,&#10;    especificacion TEXT NOT NULL,&#10;    ubicacion VARCHAR(255) NOT NULL,&#10;    nif_empresa VARCHAR(50) NOT NULL,&#10;    creado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    actualizado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    FOREIGN KEY (nif_empresa) REFERENCES empresa(nif)&#10;);&#10;```&#10;&#10;## Gestión de Errores&#10;&#10;- Si falta algún campo: mensaje de advertencia&#10;- Si el precio no es numérico: mensaje de error&#10;- Si hay error en el guardado: mensaje de error con detalles&#10;- Si todo es correcto: mensaje de éxito&#10;&#10;## Notas Técnicas&#10;&#10;- **Patrón de diseño**: MVC (Model-View-Controller)&#10;- **Comunicación**: Cliente-Servidor mediante sockets&#10;- **Serialización**: Java Serialization para objetos de dominio&#10;- **Generación de ID**: UUID aleatorio en el controlador&#10;- **Conexión a BD**: Lee configuración de `properties.xml`&#10;- **Thread-safe**: Cada petición se maneja en un hilo separado en el servidor&#10;&#10;## Extensiones Futuras&#10;&#10;Posibles mejoras que se pueden implementar:&#10;&#10;1. **Listado de anuncios**: Panel para ver todos los anuncios de una empresa&#10;2. **Edición de anuncios**: Permitir modificar anuncios existentes&#10;3. **Eliminación de anuncios**: Permitir borrar anuncios&#10;4. **Búsqueda y filtrado**: Buscar anuncios por categoría, precio, ubicación&#10;5. **Imágenes**: Añadir soporte para imágenes en los anuncios&#10;6. **Estadísticas**: Panel con métricas sobre los anuncios publicados&#10;7. **Notificaciones**: Alertar cuando se crea un nuevo anuncio en una categoría&#10;&#10;## Solución de Problemas&#10;&#10;### Error de conexión a la base de datos&#10;- Verifica que la IP en `properties.xml` sea correcta&#10;- Confirma que el servidor PostgreSQL esté activo&#10;- Comprueba las credenciales de acceso&#10;&#10;### El botón &quot;Poner anuncio&quot; no aparece&#10;- Asegúrate de que el usuario tenga el perfil de empresa completado&#10;- Verifica que el NIF de la empresa esté guardado en la BD&#10;&#10;### Error al crear anuncio&#10;- Revisa los logs del servidor para más detalles&#10;- Verifica que la tabla `anuncio` exista en la base de datos&#10;- Confirma que exista la clave foránea hacia la tabla `empresa`&#10;&#10;## Contacto y Soporte&#10;&#10;Para más información o soporte, contacta con el equipo de desarrollo.&#10;&#10;" />
              <option name="updatedContent" value="# Documentación del Flujo de Creación de Anuncios&#10;&#10;## Descripción General&#10;&#10;Se ha implementado un flujo completo para crear anuncios en la aplicación Java Swing, siguiendo el patrón MVC y utilizando la infraestructura de comunicación cliente-servidor existente.&#10;&#10;## Componentes Implementados&#10;&#10;### 1. Modelo de Dominio&#10;- **Archivo**: `src/main/java/icai/dtc/isw/domain/Anuncio.java`&#10;- **Descripción**: Clase que representa un anuncio con todos sus atributos.&#10;- **Campos**:&#10;  - `id` (String): Identificador único (UUID)&#10;  - `descripcion` (String): Descripción del anuncio&#10;  - `precio` (Double): Precio del servicio/producto&#10;  - `categoria` (String): Categoría del anuncio&#10;  - `especificacion` (String): Especificaciones adicionales&#10;  - `ubicacion` (String): Ubicación del servicio/producto&#10;  - `nifEmpresa` (String): NIF de la empresa que publica&#10;  - `creadoEn` (Timestamp): Fecha de creación&#10;  - `actualizadoEn` (Timestamp): Fecha de última actualización&#10;&#10;### 2. Capa de Acceso a Datos (DAO)&#10;- **Archivo**: `src/main/java/icai/dtc/isw/dao/AnuncioDAO.java`&#10;- **Métodos principales**:&#10;  - `insert(Anuncio)`: Inserta un nuevo anuncio&#10;  - `findById(String)`: Busca un anuncio por ID&#10;  - `findByNifEmpresa(String)`: Lista anuncios de una empresa&#10;  - `findAll()`: Lista todos los anuncios&#10;&#10;### 3. Controlador&#10;- **Archivo**: `src/main/java/icai/dtc/isw/controler/AnuncioControler.java`&#10;- **Métodos principales**:&#10;  - `createAnuncio(...)`: Crea un anuncio con validaciones&#10;  - `getAnuncio(String)`: Obtiene un anuncio por ID&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;  - `getAllAnuncios()`: Lista todos los anuncios&#10;&#10;### 4. API del Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/AnuncioApi.java`&#10;- **Descripción**: Interfaz para comunicarse con el servidor mediante sockets.&#10;- **Métodos**:&#10;  - `createAnuncio(...)`: Envía petición para crear un anuncio&#10;  - `getAnuncio(String)`: Obtiene un anuncio del servidor&#10;  - `getAnunciosByEmpresa(String)`: Lista anuncios de una empresa&#10;&#10;### 5. Interfaz de Usuario&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/CrearAnuncioPanel.java`&#10;- **Descripción**: Diálogo modal para crear un nuevo anuncio.&#10;- **Campos del formulario**:&#10;  - Descripción (área de texto)&#10;  - Precio (campo numérico)&#10;  - Categoría (ComboBox con opciones predefinidas)&#10;  - Especificación (campo de texto)&#10;  - Ubicación (campo de texto)&#10;  - NIF Empresa (campo de solo lectura, auto-rellenado)&#10;&#10;### 6. Integración en EmpresaPanel&#10;- **Archivo**: `src/main/java/icai/dtc/isw/ui/EmpresaPanel.java`&#10;- **Cambios**: El botón &quot;Poner anuncio&quot; ahora abre el diálogo `CrearAnuncioPanel`.&#10;&#10;### 7. Servidor&#10;- **Archivo**: `src/main/java/icai/dtc/isw/server/SocketServer.java`&#10;- **Endpoints añadidos**:&#10;  - `/anuncio/create`: Crea un nuevo anuncio&#10;  - `/anuncio/get`: Obtiene un anuncio por ID&#10;  - `/anuncio/list`: Lista anuncios de una empresa&#10;&#10;### 8. Cliente&#10;- **Archivo**: `src/main/java/icai/dtc/isw/client/Client.java`&#10;- **Cambios**: Añadidos casos para manejar las respuestas del servidor:&#10;  - `/anuncioCreateResponse`&#10;  - `/anuncioGetResponse`&#10;  - `/anuncioListResponse`&#10;&#10;## Instalación y Configuración&#10;&#10;### 1. Base de Datos&#10;&#10;Ejecuta el script SQL en tu base de datos PostgreSQL de AWS:&#10;&#10;```bash&#10;psql -h ec2-13-60-40-17.eu-north-1.compute.amazonaws.com -U postgres -d postgres -f src/main/resources/create_anuncio_table.sql&#10;```&#10;&#10;O conéctate manualmente y ejecuta el contenido del archivo `create_anuncio_table.sql`.&#10;&#10;### 2. Compilación&#10;&#10;Compila el proyecto usando Maven:&#10;&#10;```bash&#10;mvn clean compile&#10;```&#10;&#10;### 3. Ejecución&#10;&#10;1. **Iniciar el servidor**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.server.SocketServer&#10;   ```&#10;&#10;2. **Iniciar el cliente**:&#10;   ```bash&#10;   java -cp target/classes icai.dtc.isw.ui.AppMovilMock&#10;   ```&#10;&#10;## Flujo de Uso&#10;&#10;1. El usuario inicia sesión en la aplicación.&#10;2. Navega a &quot;Mi Empresa&quot;.&#10;3. Si ya tiene el perfil de empresa completado, verá el botón &quot;Poner anuncio&quot;.&#10;4. Al hacer clic en &quot;Poner anuncio&quot;, se abre un diálogo modal.&#10;5. Rellena todos los campos obligatorios:&#10;   - **Descripción**: Texto largo describiendo el anuncio&#10;   - **Precio**: Valor numérico (ej: 99.99)&#10;   - **Categoría**: Selección de una lista desplegable&#10;   - **Especificación**: Detalles adicionales&#10;   - **Ubicación**: Dónde se ofrece el servicio/producto&#10;   - **NIF Empresa**: Auto-rellenado (solo lectura)&#10;6. Hace clic en &quot;Crear anuncio&quot;.&#10;7. El sistema valida los campos:&#10;   - Ningún campo puede estar vacío&#10;   - El precio debe ser un número válido mayor que cero&#10;8. Si todo es correcto, se envía al servidor.&#10;9. El servidor crea el anuncio en la base de datos.&#10;10. Se muestra un mensaje de éxito y se cierra el diálogo.&#10;&#10;## Validaciones Implementadas&#10;&#10;### En el Cliente (CrearAnuncioPanel)&#10;- Campos obligatorios no pueden estar vacíos&#10;- El precio debe ser un número válido&#10;- El precio debe ser mayor que cero&#10;&#10;### En el Controlador (AnuncioControler)&#10;- Validación de campos nulos o vacíos&#10;- Validación de precio positivo&#10;- Generación automática de UUID para el ID&#10;&#10;### En la Base de Datos&#10;- Restricción CHECK para precio &gt; 0&#10;- Clave foránea hacia la tabla empresa&#10;- Timestamps automáticos para creado_en y actualizado_en&#10;- Trigger para actualizar actualizado_en automáticamente&#10;&#10;## Categorías Disponibles&#10;&#10;1. Hogar y reparaciones&#10;2. Salud, belleza y cuidados&#10;3. Educación y cultura&#10;4. Eventos y ocio&#10;5. Negocio y administración&#10;6. Logística y movilidad&#10;7. Tecnología y digital&#10;&#10;## Estructura de la Tabla en PostgreSQL&#10;&#10;**Nombre de la tabla:** `anuncios` (plural)&#10;&#10;```sql&#10;CREATE TABLE anuncios (&#10;    id VARCHAR(255) PRIMARY KEY,&#10;    descripcion TEXT NOT NULL,&#10;    precio DECIMAL(10, 2) NOT NULL CHECK (precio &gt; 0),&#10;    categoria VARCHAR(100) NOT NULL,&#10;    especificacion TEXT NOT NULL,&#10;    ubicacion VARCHAR(255) NOT NULL,&#10;    nif_empresa VARCHAR(50) NOT NULL,&#10;    creado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    actualizado_en TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    FOREIGN KEY (nif_empresa) REFERENCES empresa(nif)&#10;);&#10;```&#10;&#10;## Gestión de Errores&#10;&#10;- Si falta algún campo: mensaje de advertencia&#10;- Si el precio no es numérico: mensaje de error&#10;- Si hay error en el guardado: mensaje de error con detalles&#10;- Si todo es correcto: mensaje de éxito&#10;&#10;## Notas Técnicas&#10;&#10;- **Patrón de diseño**: MVC (Model-View-Controller)&#10;- **Comunicación**: Cliente-Servidor mediante sockets&#10;- **Serialización**: Java Serialization para objetos de dominio&#10;- **Generación de ID**: UUID aleatorio en el controlador&#10;- **Conexión a BD**: Lee configuración de `properties.xml`&#10;- **Thread-safe**: Cada petición se maneja en un hilo separado en el servidor&#10;&#10;## Extensiones Futuras&#10;&#10;Posibles mejoras que se pueden implementar:&#10;&#10;1. **Listado de anuncios**: Panel para ver todos los anuncios de una empresa&#10;2. **Edición de anuncios**: Permitir modificar anuncios existentes&#10;3. **Eliminación de anuncios**: Permitir borrar anuncios&#10;4. **Búsqueda y filtrado**: Buscar anuncios por categoría, precio, ubicación&#10;5. **Imágenes**: Añadir soporte para imágenes en los anuncios&#10;6. **Estadísticas**: Panel con métricas sobre los anuncios publicados&#10;7. **Notificaciones**: Alertar cuando se crea un nuevo anuncio en una categoría&#10;&#10;## Solución de Problemas&#10;&#10;### Error de conexión a la base de datos&#10;- Verifica que la IP en `properties.xml` sea correcta&#10;- Confirma que el servidor PostgreSQL esté activo&#10;- Comprueba las credenciales de acceso&#10;&#10;### El botón &quot;Poner anuncio&quot; no aparece&#10;- Asegúrate de que el usuario tenga el perfil de empresa completado&#10;- Verifica que el NIF de la empresa esté guardado en la BD&#10;&#10;### Error al crear anuncio&#10;- Revisa los logs del servidor para más detalles&#10;- Verifica que la tabla `anuncio` exista en la base de datos&#10;- Confirma que exista la clave foránea hacia la tabla `empresa`&#10;&#10;## Contacto y Soporte&#10;&#10;Para más información o soporte, contacta con el equipo de desarrollo.&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/icai/dtc/isw/dao/AnuncioDAO.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/icai/dtc/isw/dao/AnuncioDAO.java" />
              <option name="originalContent" value="package icai.dtc.isw.dao;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class AnuncioDAO {&#10;&#10;    /**&#10;     * Inserta un nuevo anuncio en la base de datos.&#10;     * Los campos creado_en y actualizado_en se establecen a NOW().&#10;     */&#10;    public boolean insert(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            INSERT INTO anuncios (id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en)&#10;            VALUES (?, ?, ?, ?, ?, ?, ?, NOW(), NOW())&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getId());&#10;            pst.setString(2, anuncio.getDescripcion());&#10;            pst.setDouble(3, anuncio.getPrecio());&#10;            pst.setString(4, anuncio.getCategoria());&#10;            pst.setString(5, anuncio.getEspecificacion());&#10;            pst.setString(6, anuncio.getUbicacion());&#10;            pst.setString(7, anuncio.getNifEmpresa());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Obtiene un anuncio por su ID.&#10;     */&#10;    public Anuncio findById(String id) {&#10;        if (id == null || id.isBlank()) return null;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                if (rs.next()) {&#10;                    return mapResultSetToAnuncio(rs);&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios de una empresa (por NIF).&#10;     */&#10;    public List&lt;Anuncio&gt; findByNifEmpresa(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        if (nifEmpresa == null || nifEmpresa.isBlank()) return anuncios;&#10;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE nif_empresa = ? ORDER BY creado_en DESC&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, nifEmpresa);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                while (rs.next()) {&#10;                    anuncios.add(mapResultSetToAnuncio(rs));&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios.&#10;     */&#10;    public List&lt;Anuncio&gt; findAll() {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios ORDER BY creado_en DESC&quot;;&#10;&#10;        try (Statement st = con.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) {&#10;                anuncios.add(mapResultSetToAnuncio(rs));&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Actualiza un anuncio existente.&#10;     * El campo actualizado_en se establece a NOW().&#10;     */&#10;    public boolean update(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            UPDATE anuncios &#10;            SET descripcion = ?, precio = ?, categoria = ?, especificacion = ?, &#10;                ubicacion = ?, actualizado_en = NOW()&#10;            WHERE id = ?&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getDescripcion());&#10;            pst.setDouble(2, anuncio.getPrecio());&#10;            pst.setString(3, anuncio.getCategoria());&#10;            pst.setString(4, anuncio.getEspecificacion());&#10;            pst.setString(5, anuncio.getUbicacion());&#10;            pst.setString(6, anuncio.getId());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Elimina un anuncio por su ID.&#10;     */&#10;    public boolean delete(String id) {&#10;        if (id == null || id.isBlank()) return false;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;DELETE FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Mapea un ResultSet a un objeto Anuncio.&#10;     */&#10;    private Anuncio mapResultSetToAnuncio(ResultSet rs) throws SQLException {&#10;        Anuncio a = new Anuncio();&#10;        a.setId(rs.getString(&quot;id&quot;));&#10;        a.setDescripcion(rs.getString(&quot;descripcion&quot;));&#10;        a.setPrecio(rs.getDouble(&quot;precio&quot;));&#10;        a.setCategoria(rs.getString(&quot;categoria&quot;));&#10;        a.setEspecificacion(rs.getString(&quot;especificacion&quot;));&#10;        a.setUbicacion(rs.getString(&quot;ubicacion&quot;));&#10;        a.setNifEmpresa(rs.getString(&quot;nif_empresa&quot;));&#10;        a.setCreadoEn(rs.getTimestamp(&quot;creado_en&quot;));&#10;        a.setActualizadoEn(rs.getTimestamp(&quot;actualizado_en&quot;));&#10;        return a;&#10;    }&#10;}&#10;&#10;" />
              <option name="updatedContent" value="package icai.dtc.isw.dao;&#10;&#10;import icai.dtc.isw.domain.Anuncio;&#10;&#10;import java.sql.*;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;public class AnuncioDAO {&#10;&#10;    /**&#10;     * Inserta un nuevo anuncio en la base de datos.&#10;     * Los campos creado_en y actualizado_en se establecen a NOW().&#10;     */&#10;    public boolean insert(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            INSERT INTO anuncios (id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en)&#10;            VALUES (?, ?, ?, ?, ?, ?, ?, NOW(), NOW())&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getId());&#10;            pst.setString(2, anuncio.getDescripcion());&#10;            pst.setDouble(3, anuncio.getPrecio());&#10;            pst.setString(4, anuncio.getCategoria());&#10;            pst.setString(5, anuncio.getEspecificacion());&#10;            pst.setString(6, anuncio.getUbicacion());&#10;            pst.setString(7, anuncio.getNifEmpresa());&#10;&#10;            int rows = pst.executeUpdate();&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Obtiene un anuncio por su ID.&#10;     */&#10;    public Anuncio findById(String id) {&#10;        if (id == null || id.isBlank()) return null;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                if (rs.next()) {&#10;                    return mapResultSetToAnuncio(rs);&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return null;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios de una empresa (por NIF).&#10;     */&#10;    public List&lt;Anuncio&gt; findByNifEmpresa(String nifEmpresa) {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        if (nifEmpresa == null || nifEmpresa.isBlank()) return anuncios;&#10;&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios WHERE nif_empresa = ? ORDER BY creado_en DESC&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, nifEmpresa);&#10;            try (ResultSet rs = pst.executeQuery()) {&#10;                while (rs.next()) {&#10;                    anuncios.add(mapResultSetToAnuncio(rs));&#10;                }&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Obtiene todos los anuncios.&#10;     */&#10;    public List&lt;Anuncio&gt; findAll() {&#10;        List&lt;Anuncio&gt; anuncios = new ArrayList&lt;&gt;();&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;SELECT id, descripcion, precio, categoria, especificacion, ubicacion, nif_empresa, creado_en, actualizado_en FROM anuncios ORDER BY creado_en DESC&quot;;&#10;&#10;        try (Statement st = con.createStatement();&#10;             ResultSet rs = st.executeQuery(sql)) {&#10;            while (rs.next()) {&#10;                anuncios.add(mapResultSetToAnuncio(rs));&#10;            }&#10;        } catch (SQLException ex) {&#10;            ex.printStackTrace();&#10;        }&#10;        return anuncios;&#10;    }&#10;&#10;    /**&#10;     * Actualiza un anuncio existente.&#10;     * El campo actualizado_en se establece a NOW().&#10;     */&#10;    public boolean update(Anuncio anuncio) {&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;&quot;&quot;&#10;            UPDATE anuncios &#10;            SET descripcion = ?, precio = ?, categoria = ?, especificacion = ?, &#10;                ubicacion = ?, actualizado_en = NOW()&#10;            WHERE id = ?&#10;            &quot;&quot;&quot;;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, anuncio.getDescripcion());&#10;            pst.setDouble(2, anuncio.getPrecio());&#10;            pst.setString(3, anuncio.getCategoria());&#10;            pst.setString(4, anuncio.getEspecificacion());&#10;            pst.setString(5, anuncio.getUbicacion());&#10;            pst.setString(6, anuncio.getId());&#10;&#10;            int rows = pst.executeUpdate();&#10;            System.out.println(&quot;AnuncioDAO.update: Filas actualizadas = &quot; + rows + &quot; para ID = &quot; + anuncio.getId());&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;AnuncioDAO.update: Error SQL al actualizar anuncio ID = &quot; + anuncio.getId());&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Elimina un anuncio por su ID.&#10;     */&#10;    public boolean delete(String id) {&#10;        if (id == null || id.isBlank()) {&#10;            System.out.println(&quot;AnuncioDAO.delete: ID es null o vacío&quot;);&#10;            return false;&#10;        }&#10;        Connection con = ConnectionDAO.getInstance().getConnection();&#10;        String sql = &quot;DELETE FROM anuncios WHERE id = ?&quot;;&#10;&#10;        try (PreparedStatement pst = con.prepareStatement(sql)) {&#10;            pst.setString(1, id);&#10;            int rows = pst.executeUpdate();&#10;            System.out.println(&quot;AnuncioDAO.delete: Filas eliminadas = &quot; + rows + &quot; para ID = &quot; + id);&#10;            return rows &gt; 0;&#10;        } catch (SQLException ex) {&#10;            System.err.println(&quot;AnuncioDAO.delete: Error SQL al eliminar anuncio ID = &quot; + id);&#10;            ex.printStackTrace();&#10;            return false;&#10;        }&#10;    }&#10;&#10;    /**&#10;     * Mapea un ResultSet a un objeto Anuncio.&#10;     */&#10;    private Anuncio mapResultSetToAnuncio(ResultSet rs) throws SQLException {&#10;        Anuncio a = new Anuncio();&#10;        a.setId(rs.getString(&quot;id&quot;));&#10;        a.setDescripcion(rs.getString(&quot;descripcion&quot;));&#10;        a.setPrecio(rs.getDouble(&quot;precio&quot;));&#10;        a.setCategoria(rs.getString(&quot;categoria&quot;));&#10;        a.setEspecificacion(rs.getString(&quot;especificacion&quot;));&#10;        a.setUbicacion(rs.getString(&quot;ubicacion&quot;));&#10;        a.setNifEmpresa(rs.getString(&quot;nif_empresa&quot;));&#10;        a.setCreadoEn(rs.getTimestamp(&quot;creado_en&quot;));&#10;        a.setActualizadoEn(rs.getTimestamp(&quot;actualizado_en&quot;));&#10;        return a;&#10;    }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>